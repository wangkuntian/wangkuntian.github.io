
<!DOCTYPE html>
<html lang="zh-en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Wang kuntian&#39;s Blog">
    <title>OpenStack Senlin集群即服务 - Wang kuntian&#39;s Blog</title>
    <meta name="author" content="Wang kuntian">
    
        <meta name="keywords" content="OpenStack,Senlin">
    
    
        <link rel="icon" href="https://wangkuntian.github.io/assets/images/favicon.png">
    
    
        
            <link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml">
        
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Wang kuntian","sameAs":["https://github.com/wangkuntian","mailto:wangkuntian1994@163.com"],"image":"faker.jpg"},"articleBody":"Senlin是针对OpenStack云的集群服务。它创建并操作其他OpenStack服务公开的同类对象的集群。目的是使编排相似对象的过程更容易。\n\n\n\nSenlin与其他OpenStack服务进行交互，以便可以创建和操作这些服务公开的资源集群。这些交互主要通过配置文件插件完成。每个配置文件类型的实现都使Senlin能够创建，更新，删除特定类型的资源。\n集群（Cluster）可以与不同的策略（Policy）对象相关联，可以在不同的实施级别上对其进行检查/实施。通过服务API，用户可以动态地将节点（Node）添加到集群中或从集群中删除节点，以及附加和分离策略，例如创建策略，删除策略，负载均衡策略，扩展策略，健康状况策略等。通过与其他OpenStack项目集成，可以使用户更轻松地管理大型资源池的部署和业务流程。\nSenlin被设计为能够管理不同类型的对象。使用配置文件类型（Profile Type）实现管理对象的生命周期，这些实现是可以由服务引擎动态加载的插件。\n组件senlinclientsenlinclient软件包为openstackclient工具提供了一个插件，因此您具有命令行界面，可与senlin-api通信以管理集群，节点，配置文件，策略，操作（Action）和事件（Event）。\nsenlin-dashboardsenlin-dashboard是一个Horizo​​n插件，可为Senlin提供UI。\nsenlin-apisenlin-api组件提供了OpenStack本机REST API，该API通过RPC将API请求发送到senlin-engine来处理API请求。\nsenlin-enginesenlin-engine的主要职责是创建和编排集群，节点，配置文件和策略。\n概念Profile Type配置文件类型（Profile Type）可以视为配置文件（Profile）对象的元类型。启动senlin-engine时，Profile Type的注册表会建立在内存中。未来，Senlin将允许用户提供其他配置文件类型的实现，作为可动态加载的插件。\nProfile Type的实现指出需要哪些字段。通过引用此Profile Type创建Profile时，将为字段分配具体值。\n查看Profile Types查看Senlin服务器支持的Profile Type的列表。\n1openstack cluster profile type list\n\n\n查看详细Profile Type每个Profile Type都有一个用于其规范的架构，该架构描述了可以接受的名称和属性类型。要显示特定Profile Type的架构以及其他属性，可以使用下面的命令。\nos.heat.stack\n123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566openstack cluster profile type show os.heat.stack-1.0support_status:  &#x27;1.0&#x27;:  - since: &#x27;2016.04&#x27;    status: SUPPORTEDid: os.heat.stack-1.0location:  cloud: &#x27;&#x27;  project:    domain_id: null    domain_name: Default    id: f52380b8eb5345f0a568a186a5a832a5    name: admin  region_name: RegionOne  zone: nullname: os.heat.stack-1.0schema:  context:    default: &#123;&#125;    description: A dictionary for specifying the customized context for stack operations.    required: false    type: Map    updatable: false  disable_rollback:    default: true    description: A boolean specifying whether a stack operation can be rolled back.    required: false    type: Boolean    updatable: true  environment:    default: &#123;&#125;    description: A map that specifies the environment used for stack operations.    required: false    type: Map    updatable: true  files:    default: &#123;&#125;    description: Contents of files referenced by the template, if any.    required: false    type: Map    updatable: true  parameters:    default: &#123;&#125;    description: Parameters to be passed to Heat for stack operations.    required: false    type: Map    updatable: true  template:    default: &#123;&#125;    description: Heat stack template.    required: false    type: Map    updatable: true  template_url:    default: &#x27;&#x27;    description: Heat stack template url.    required: false    type: String    updatable: true  timeout:    description: A integer that specifies the number of minutes that a stack operation      times out.    required: false    type: Integer    updatable: true\n\nos.nova.server\n123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229openstack cluster profile type show os.nova.server-1.0support_status:  &#x27;1.0&#x27;:  - since: &#x27;2016.04&#x27;    status: SUPPORTEDid: os.nova.server-1.0location:  cloud: &#x27;&#x27;  project:    domain_id: null    domain_name: Default    id: f52380b8eb5345f0a568a186a5a832a5    name: admin  region_name: RegionOne  zone: nullname: os.nova.server-1.0schema:  admin_pass:    description: Password for the administrator account.    required: false    type: String    updatable: false  auto_disk_config:    default: true    description: Whether the disk partition is done automatically.    required: false    type: Boolean    updatable: false  availability_zone:    description: Name of availability zone for running the server.    required: false    type: String    updatable: false  block_device_mapping_v2:    description: A list specifying the properties of block devices to be used for      this server.    required: false    schema:      &#x27;*&#x27;:        description: A map specifying the properties of a block device to be used          by the server.        required: false        schema:          boot_index:            description: Define the boot order of the device            required: false            type: Integer            updatable: false          delete_on_termination:            description: Whether to delete the volume when the server stops.            required: false            type: Boolean            updatable: false          destination_type:            description: Volume destination type, must be &#x27;volume&#x27; or &#x27;local&#x27;            required: true            type: String            updatable: false          device_name:            description: Name of the device(e.g. vda, xda, ....).            required: false            type: String            updatable: false          device_type:            description: Type of the device(e.g. disk, cdrom, ...).            required: false            type: String            updatable: false          disk_bus:            description: Bus of the device.            required: false            type: String            updatable: false          guest_format:            description: Specifies the disk file system format(e.g. swap, ephemeral,              ...).            required: false            type: String            updatable: false          source_type:            description: Volume source type, must be one of &#x27;image&#x27;, &#x27;snapshot&#x27;, &#x27;volume&#x27;              or &#x27;blank&#x27;            required: true            type: String            updatable: false          uuid:            description: ID of the source image, snapshot or volume            required: false            type: String            updatable: false          volume_size:            description: Size of the block device in MB(for swap) and in GB(for other              formats)            required: true            type: Integer            updatable: false        type: Map        updatable: false    type: List    updatable: false  config_drive:    description: Whether config drive should be enabled for the server.    required: false    type: Boolean    updatable: false  context:    description: Customized security context for operating servers.    required: false    type: Map    updatable: false  flavor:    description: ID of flavor used for the server.    required: true    type: String    updatable: true  image:    description: ID of image to be used for the new server.    required: false    type: String    updatable: true  key_name:    description: Name of Nova keypair to be injected to server.    required: false    type: String    updatable: false  metadata:    description: A collection of key/value pairs to be associated with the server      created. Both key and value must be &lt;=255 chars.    required: false    type: Map    updatable: true  name:    description: Name of the server. When omitted, the node name will be used.    required: false    type: String    updatable: true  networks:    description: List of networks for the server.    required: false    schema:      &#x27;*&#x27;:        description: A map specifying the properties of a network for uses.        required: false        schema:          fixed_ip:            description: Fixed IP to be used by the network.            required: false            type: String            updatable: false          floating_ip:            description: The floating IP address to be associated with this port.            required: false            type: String            updatable: false          floating_network:            description: The network on which to create a floating IP            required: false            type: String            updatable: false          network:            description: Name or ID of network to create a port on.            required: false            type: String            updatable: false          port:            description: Port ID to be used by the network.            required: false            type: String            updatable: false          security_groups:            description: A list of security groups to be attached to this port.            required: false            schema:              &#x27;*&#x27;:                description: Name of a security group                required: true                type: String                updatable: false            type: List            updatable: false        type: Map        updatable: false    type: List    updatable: true  personality:    description: List of files to be injected into the server, where each.    required: false    schema:      &#x27;*&#x27;:        description: A map specifying the path &amp; contents for an injected file.        required: false        schema:          contents:            description: Contents of the file to be injected.            required: true            type: String            updatable: false          path:            description: In-instance path for the file to be injected.            required: true            type: String            updatable: false        type: Map        updatable: false    type: List    updatable: false  scheduler_hints:    description: A collection of key/value pairs to be associated with the Scheduler      hints. Both key and value must be &lt;=255 chars.    required: false    type: Map    updatable: false  security_groups:    description: List of security groups.    required: false    schema:      &#x27;*&#x27;:        description: Name of a security group        required: true        type: String        updatable: false    type: List    updatable: false  user_data:    description: User data to be exposed by the metadata server.    required: false    type: String    updatable: false\n\ncontainer.dockerinc.docker\n123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354openstack cluster profile type show container.dockerinc.docker-1.0support_status:  &#x27;1.0&#x27;:  - since: &#x27;2017.02&#x27;    status: EXPERIMENTALid: container.dockerinc.docker-1.0location:  cloud: &#x27;&#x27;  project:    domain_id: null    domain_name: Default    id: f52380b8eb5345f0a568a186a5a832a5    name: admin  region_name: RegionOne  zone: nullname: container.dockerinc.docker-1.0schema:  command:    description: The command to run when container is started.    required: false    type: String    updatable: false  context:    description: Customized security context for operating containers.    required: false    type: Map    updatable: false  host_cluster:    description: The cluster on which container will be launched.    required: false    type: String    updatable: false  host_node:    description: The node on which container will be launched.    required: false    type: String    updatable: false  image:    description: The image used to create a container    required: true    type: String    updatable: false  name:    description: The name of the container.    required: false    type: String    updatable: true  port:    default: 2375    description: The port number used to connect to docker daemon.    required: false    type: Integer    updatable: false\n\n\ndefault：未明确指定时属性的默认值。\ndescription：属性的文字描述。\nrequired：是否必须指定属性。这种属性通常没有默认值。\ntype：String, Integer, Boolean, Map或者List。\nupdatable：属性是否可更新。\n\n\n\n查看Profile Type操作查看Profile Type支持的操作。\nos.heat.stack\n12345678openstack cluster profile type ops os.heat.stack-1.0operations:  abandon:    description: Abandon a heat stack node.    required: false    type: Map    updatable: false\n\nos.nova.server\n1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071openstack cluster profile type ops os.nova.server-1.0                                                 operations:  change_password:    description: Change the administrator password.    parameters:      admin_pass:        description: New password for the administrator.        required: false        type: String  evacuate:    description: Evacuate the server to a different host.    parameters:      force:        description: Whether the evacuation should be a forced one.        required: false        type: String      host:        description: The target host to evacuate the server.        required: false        type: String  lock:    description: Lock the server.    parameters: &#123;&#125;  pause:    description: Pause the server from running.    parameters: &#123;&#125;  reboot:    description: Reboot the nova server.    parameters:      type:        constraints:        - constraint:          - SOFT          - HARD          type: AllowedValues        default: SOFT        description: Type of reboot which can be &#x27;SOFT&#x27; or &#x27;HARD&#x27;.        required: false        type: String  rebuild:    description: Rebuild the server using current image and admin password.    parameters: &#123;&#125;  rescue:    description: Rescue the server.    parameters:      image_ref:        description: A string referencing the image to use.        required: false        type: String  resume:    description: Resume the running of the server.    parameters: &#123;&#125;  start:    description: Start the server.    parameters: &#123;&#125;  stop:    description: Stop the server.    parameters: &#123;&#125;  suspend:    description: Suspend the running of the server.    parameters: &#123;&#125;  unlock:    description: Unlock the server.    parameters: &#123;&#125;  unpause:    description: Unpause the server to running state.    parameters: &#123;&#125;  unrescue:    description: Unrescue the server.    parameters: &#123;&#125;\n\ncontainer.dockerinc.docker\n12345678910111213141516openstack cluster profile type ops container.dockerinc.docker-1.0                                     operations:  pause:    description: Pause a container.    parameters: &#123;&#125;  restart:    description: Restart a container.    parameters:      wait_time:        description: Number of seconds to wait before killing the container.        required: false        type: Integer  unpause:    description: Unpause a container.    parameters: &#123;&#125;\n\n\ndescription：属性的文字描述。\nrequired：是否必须指定属性。这种属性通常没有默认值。\ntype：String, Integer, Boolean, Map或者List。\nupdatable：属性是否可更新。\n\n\n\nProfile配置文件（Profile）是用于创建节点（Node）的模型，可以将其视为具有唯一ID的Profile Type的实例。Profile在名为spec的属性中编码创建节点所需的信息。\nProfile Type实现的主要工作是将用户提供的JSON数据结构转换为驱动程序可以使用的信息。驱动程序将根据提供的信息创建/删除/更新物理对象。\n创建Profile在使用集群（Cluster）或节点（Node）之前，您将需要使用配置文件类型（Profile Type）创建的配置文件（Profile）对象。要创建配置文件，您将需要YAML格式的spec文件。\n12345678# /examples/profiles/heat_stack/random_string/ heat_stack_random_string.yamltype: os.heat.stackversion: 1.0properties:  name: random_string_stack  template: random_string_template.yaml  context:    region_name: RegionOne\nrandom_string_template.yaml\n12345678910111213heat_template_version: 2014-10-16parameters:  str_length:    type: number    default: 64resources:  random:    type: OS::Heat::RandomString    properties:      length: &#123;get_param: str_length&#125;outputs:  result:    value: &#123;get_attr: [random, value]&#125;\n12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061openstack cluster profile create --spec heat_stack_random_string.yaml my_stack+------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+| Field      | Value                                                                                                                                                                                       |+------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+| created_at | 2019-09-25T08:02:43Z                                                                                                                                                                        || domain_id  | None                                                                                                                                                                                        || id         | ba4295d7-6800-4db4-8fe8-43ea978c91f9                                                                                                                                                        || location   | Munch(&#123;&#x27;project&#x27;: Munch(&#123;&#x27;domain_id&#x27;: None, &#x27;id&#x27;: u&#x27;f52380b8eb5345f0a568a186a5a832a5&#x27;, &#x27;name&#x27;: &#x27;admin&#x27;, &#x27;domain_name&#x27;: &#x27;Default&#x27;&#125;), &#x27;cloud&#x27;: &#x27;&#x27;, &#x27;region_name&#x27;: &#x27;RegionOne&#x27;, &#x27;zone&#x27;: None&#125;) || metadata   | &#123;&#125;                                                                                                                                                                                          || name       | my_stack                                                                                                                                                                                    || project_id | f52380b8eb5345f0a568a186a5a832a5                                                                                                                                                            || spec       | +------------+---------------------------------------------+                                                                                                                                ||            | | property   | value                                       |                                                                                                                                ||            | +------------+---------------------------------------------+                                                                                                                                ||            | | properties | &#123;                                           |                                                                                                                                ||            | |            |   &quot;files&quot;: &#123;&#125;,                              |                                                                                                                                ||            | |            |   &quot;disable_rollback&quot;: true,                 |                                                                                                                                ||            | |            |   &quot;template&quot;: &#123;                             |                                                                                                                                ||            | |            |     &quot;outputs&quot;: &#123;                            |                                                                                                                                ||            | |            |       &quot;result&quot;: &#123;                           |                                                                                                                                ||            | |            |         &quot;value&quot;: &#123;                          |                                                                                                                                ||            | |            |           &quot;get_attr&quot;: [                     |                                                                                                                                ||            | |            |             &quot;random&quot;,                       |                                                                                                                                ||            | |            |             &quot;value&quot;                         |                                                                                                                                ||            | |            |           ]                                 |                                                                                                                                ||            | |            |         &#125;                                   |                                                                                                                                ||            | |            |       &#125;                                     |                                                                                                                                ||            | |            |     &#125;,                                      |                                                                                                                                ||            | |            |     &quot;heat_template_version&quot;: &quot;2014-10-16&quot;,  |                                                                                                                                ||            | |            |     &quot;resources&quot;: &#123;                          |                                                                                                                                ||            | |            |       &quot;random&quot;: &#123;                           |                                                                                                                                ||            | |            |         &quot;type&quot;: &quot;OS::Heat::RandomString&quot;,   |                                                                                                                                ||            | |            |         &quot;properties&quot;: &#123;                     |                                                                                                                                ||            | |            |           &quot;length&quot;: &#123;                       |                                                                                                                                ||            | |            |             &quot;get_param&quot;: &quot;str_length&quot;       |                                                                                                                                ||            | |            |           &#125;                                 |                                                                                                                                ||            | |            |         &#125;                                   |                                                                                                                                ||            | |            |       &#125;                                     |                                                                                                                                ||            | |            |     &#125;,                                      |                                                                                                                                ||            | |            |     &quot;parameters&quot;: &#123;                         |                                                                                                                                ||            | |            |       &quot;str_length&quot;: &#123;                       |                                                                                                                                ||            | |            |         &quot;default&quot;: 64,                      |                                                                                                                                ||            | |            |         &quot;type&quot;: &quot;number&quot;                    |                                                                                                                                ||            | |            |       &#125;                                     |                                                                                                                                ||            | |            |     &#125;                                       |                                                                                                                                ||            | |            |   &#125;,                                        |                                                                                                                                ||            | |            |   &quot;parameters&quot;: &#123;&#125;,                         |                                                                                                                                ||            | |            |   &quot;timeout&quot;: 60,                            |                                                                                                                                ||            | |            |   &quot;environment&quot;: &#123;&#125;,                        |                                                                                                                                ||            | |            |   &quot;context&quot;: &#123;                              |                                                                                                                                ||            | |            |     &quot;region_name&quot;: &quot;RegionOne&quot;              |                                                                                                                                ||            | |            |   &#125;                                         |                                                                                                                                ||            | |            | &#125;                                           |                                                                                                                                ||            | | type       | os.heat.stack                               |                                                                                                                                ||            | | version    | 1.0                                         |                                                                                                                                ||            | +------------+---------------------------------------------+                                                                                                                                || type       | os.heat.stack-1.0                                                                                                                                                                           || updated_at | None                                                                                                                                                                                        || user_id    | c1bb613f1ece4654b488c65fc0f62df8                                                                                                                                                            |+------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n（可选）可以在创建新配置文件（Profile）时将一些键值对附加到新配置文件（Profile）。此数据称为配置文件的元数据（metadata）。\n123456789openstack cluster profile create \\    --spec heat_stack_random_string.yaml \\    --metadata &quot;author=King;version=1.0&quot; \\    my_stackopenstack cluster profile create \\    --spec heat_stack_random_string.yaml \\    --metadata author=King --metadata version=1.0 \\    my_stack\n查看Profiles查看创建的Profile列表。\n1openstack cluster profile list\n\n\n查看详细Profile1openstack cluster profile show my_stack\n\n更新Profile更新Profile的名称。\n1openstack cluster profile update --name new_stack my_stack\n\n更新或者创建元数据（metadata）。\n1openstack cluster profile update --metadata version=2.2 my_stack\n不允许更改配置文件的spec。进行更改的唯一方法是使用profile create子命令来创建新的配置文件。\n\n\n删除Profile1openstack cluster profile delete my_stack\n\nCluster集群（Cluster）是一组逻辑对象，每个逻辑对象在Senlin的术语中称为节点（Node）。集群可以包含零个或多个节点。集群的profile_id属性，指定在创建/扩展新节点作为集群成员时使用的默认配置文件（Profile）。对于集群中的节点来说，拥有不同的配置文件对象是有效的，因为Senlin仅要求集群中的所有节点都具有相同的配置文件类型（Profile Type）。\n创建Cluster12345678910111213141516171819202122232425262728openstack cluster create --profile my_stack my_cluster                                                +------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+| Field            | Value                                                                                                                                                                                       |+------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+| config           | &#123;&#125;                                                                                                                                                                                          || created_at       | None                                                                                                                                                                                        || data             | &#123;&#125;                                                                                                                                                                                          || dependents       | &#123;&#125;                                                                                                                                                                                          || desired_capacity | 0                                                                                                                                                                                           || domain_id        | None                                                                                                                                                                                        || id               | eb5843d4-18c7-465f-bf65-76693f617f51                                                                                                                                                        || init_at          | 2019-09-25T09:20:40Z                                                                                                                                                                        || location         | Munch(&#123;&#x27;project&#x27;: Munch(&#123;&#x27;domain_id&#x27;: None, &#x27;id&#x27;: u&#x27;f52380b8eb5345f0a568a186a5a832a5&#x27;, &#x27;name&#x27;: &#x27;admin&#x27;, &#x27;domain_name&#x27;: &#x27;Default&#x27;&#125;), &#x27;cloud&#x27;: &#x27;&#x27;, &#x27;region_name&#x27;: &#x27;RegionOne&#x27;, &#x27;zone&#x27;: None&#125;) || max_size         | -1                                                                                                                                                                                          || metadata         | &#123;&#125;                                                                                                                                                                                          || min_size         | 0                                                                                                                                                                                           || name             | my_cluster                                                                                                                                                                                  || node_ids         |                                                                                                                                                                                             || profile_id       | ba4295d7-6800-4db4-8fe8-43ea978c91f9                                                                                                                                                        || profile_name     | my_stack                                                                                                                                                                                    || project_id       | f52380b8eb5345f0a568a186a5a832a5                                                                                                                                                            || status           | INIT                                                                                                                                                                                        || status_reason    | Initializing                                                                                                                                                                                || timeout          | 3600                                                                                                                                                                                        || updated_at       | None                                                                                                                                                                                        || user_id          | c1bb613f1ece4654b488c65fc0f62df8                                                                                                                                                            |+------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n\n从输出中，可以看到一个新的集群对象已创建并处于INIT状态。Senlin将验证使用--profile选项指定的配置文件是否存在。服务器允许值是配置文件名称，配置文件ID或配置文件对象的短ID。\n集群容量创建集群时，默认情况下senlin将创建一个没有节点的集群，即desired_capacity将设置为0。但是，可以指定集群的所需容量，集群的最大和最小。min_size的默认值为0，max_size的默认值为**-1**，这意味着集群大小没有上限。\n创建一个集群，其所需容量设置为2，最小大小设置为1，最大大小设置为3。\n1234openstack cluster create --desired-capacity 2 \\    --min-size 1 --max-size 3 \\    --profile my_stack \\    my_cluster\n当未指定desired_capacity并且未指定min_size时，senlin-engine将创建一个空集群。当指定了required_capacity集群容量或min_size时，Senlin将在创建集群对象后立即开始创建节点的过程。\n\n\n其他属性可以使用--metadata（或-M）选项将某些键值对与要创建的集群相关联。这些数据称为集群的元数据（metadata）。\n由于集群操作在执行时可能需要一些时间才能完成，并且Senlin与后端服务进行交互才能实现，因此需要一种方法来验证操作是否超时。创建集群时，可以使用--timeout选项，以秒为单位指定默认超时时间。该值将是集群的全局设置。\n可以使用选项--config将键值对传递给要创建的集群。支持以下配置属性：\n\nnode.name.format：指定如何自动命名集群节点。该值可以包含占位符，例如**$nI用于在节点索引的左边填充n个零，或$nR**用于长度为n的随机字符串。\ncluster.stop_node_before_delete：如果设置为True，则导致节点删除的集群操作（调整大小等）将首先请求节点停止。成功关闭节点后，将删除该节点。默认设置为False，集群将在不停止该节点的情况下执行节点删除。\n\n查看Clusters查看创建的集群列表。\n1openstack cluster list\n\n\n查看详细Cluster1234567891011121314151617181920212223242526272829openstack cluster show my_cluster+------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+| Field            | Value                                                                                                                                                                                       |+------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+| config           | &#123;&#125;                                                                                                                                                                                          || created_at       | 2019-09-25T09:20:40Z                                                                                                                                                                        || data             | &#123;&#125;                                                                                                                                                                                          || dependents       | &#123;&#125;                                                                                                                                                                                          || desired_capacity | 0                                                                                                                                                                                           || domain_id        | None                                                                                                                                                                                        || id               | eb5843d4-18c7-465f-bf65-76693f617f51                                                                                                                                                        || init_at          | 2019-09-25T09:20:40Z                                                                                                                                                                        || location         | Munch(&#123;&#x27;project&#x27;: Munch(&#123;&#x27;domain_id&#x27;: None, &#x27;id&#x27;: u&#x27;f52380b8eb5345f0a568a186a5a832a5&#x27;, &#x27;name&#x27;: &#x27;admin&#x27;, &#x27;domain_name&#x27;: &#x27;Default&#x27;&#125;), &#x27;cloud&#x27;: &#x27;&#x27;, &#x27;region_name&#x27;: &#x27;RegionOne&#x27;, &#x27;zone&#x27;: None&#125;) || max_size         | -1                                                                                                                                                                                          || metadata         | &#123;&#125;                                                                                                                                                                                          || min_size         | 0                                                                                                                                                                                           || name             | my_cluster                                                                                                                                                                                  || node_ids         |                                                                                                                                                                                             || profile_id       | ba4295d7-6800-4db4-8fe8-43ea978c91f9                                                                                                                                                        || profile_name     | my_stack                                                                                                                                                                                    || project_id       | f52380b8eb5345f0a568a186a5a832a5                                                                                                                                                            || status           | ACTIVE                                                                                                                                                                                      || status_reason    | CLUSTER_CREATE: number of active nodes is equal or above desired_capacity (0).                                                                                                              || timeout          | 3600                                                                                                                                                                                        || updated_at       | 2019-09-25T09:20:40Z                                                                                                                                                                        || user_id          | c1bb613f1ece4654b488c65fc0f62df8                                                                                                                                                            |+------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n从结果中，可以检查属于该集群的节点的列表。\n更新Cluster修改集群的名称。\n1openstack cluster update --name test_cluster my_cluster\n使用选项--timeout更改timeout属性。您可以使用选项--metadata更改与集群关联的元数据。\n更改集群及其成员节点使用的配置文件。\n1openstack cluster update --profile fedora21_server web_cluster\n假设集群web_cluster现在使用的是os.nova.server类型的配置文件，其中使用了Fedora 20的镜像，则上述命令将启动全局升级到使用Fedora 21的镜像的新配置文件。\n\n\n调整Cluster大小capacity--capacity，将集群调整为指定的大小。将集群test_cluster的大小调整为2个节点，前提是min_size不大于2，并且max_size不小于2或等于-1（指示集群大小没有上限）。\n1openstack cluster resize --capacity 2 my_cluster\n\nadjustment--adjustment，向集群添加指定数量的节点，或者从集群中删除指定数量的节点。（正数表示增加，负数表示删除）将两个节点添加到指定的集群：\n1openstack cluster resize --adjustment 2 my_cluster\n从指定的集群中删除2个节点：\n1openstack cluster resize --adjustment 2 my_cluster\n\npercentage--percentage，以指定百分比调整集群的大小。（正数表示扩大，负数表示缩小）\nsenlin-engine会根据集群的当前大小，指定的百分比值，约束条件（即min_size和max_size属性）计算要添加或删除的实际节点数。\n将集群大小增加30％：\n1openstack cluster resize --percentage 30 my_cluster\n将集群大小减少25％：\n1openstack cluster resize --percentage 25 my_cluster\nmin-step如果因某些限制而无法完全实现调整大小操作，则可以请求根据最大努力进行大小更改，**-–min-step**告诉senlin-engine是否仍然希望部分实现调整大小操作。\nstrict如果指定了--strict选项，Senlin将严格遵守集群大小限制。如果容量值超出范围，则该请求将被拒绝。当--strict设置为False时（默认为False），senlin-engine将尽力调整大小。\n假设有一个集群A，其min_size设置为5，当前大小为7。如果新的容量值为4，选项--strict设置为True，则该请求将被拒绝，并显示一条错误消息。如果新的容量值为4，并且未设置选项--strict，Senlin将尝试将群集的大小调整为5个节点。\n调整大小时，可以同时调整集群的min_size和max_size属性。\n\n\n在计算集群的新容量时，senlin-engine将根据以下规则确定值：\n\n如果新容量的值大于1.0或小于-1.0，则将四舍五入为值的整数部分。例如，将3.4舍入为3，-1.9将舍入为-1；\n如果新容量的值在0到1之间，Senlin会将其向上舍入为1。\n如果新容量的值在0到-1之间，Senlin会将其舍入到-1；\n除非指定了--strict选项，否则新容量应在min_size和max_size范围内（包括两端）。\n如果未给出min_size和max_size的新值，则将根据当前大小约束执行范围检查，否则，Senlin将首先验证新大小约束并针对新约束执行范围检查；\n如果指定了选项--min-step，则当新容量值的绝对值小于&lt;**MIN_STEP**&gt;时，将使用&lt;**MIN_STEP**&gt;值。\n\n\n\nCluster伸缩向集群添加两个节点：\n1openstack cluster expand --count 2 my_cluster\n从集群中删除两个节点：\n1openstack cluster shrink --count 2 my_cluster\n参数&lt;COUNT&gt;，是一个正整数，表示要添加或删除的节点数。选项--count是可选的。如果指定此选项，即使有附加的扩展策略，Senlin仍将使用它来更改群集大小。但是，如果忽略此选项，Senlin会将其视为隐式设置为值1。\n\n\n检查Cluster属于指定集群的所有节点将执行检查操作。如果节点的物理资源不是ACTIVE，则节点状态将作为检查操作的一部分进行更改。\n1openstack cluster check my_cluster\n\n\n恢复Cluster恢复集群。\n1openstack cluster recover my_cluster --check true\n选项--check是可选的。如果设置此选项，群集将在执行恢复之前执行检查操作。还原操作将从指定的群集中删除节点并重新创建它。\n\n\n删除Cluster删除集群。\n1openstack cluster delete my_cluster\n当集群中有节点时，senlin-engine将启动一个进程，以从集群中删除所有节点并销毁它们，然后再删除集群对象本身。\n\n\n\nNode节点（Node）是由Senlin服务管理的逻辑对象。一个节点在任何时候最多只能是一个集群的成员。一个节点可以是孤立节点，这意味着它不属于任何群集。\n创建Node创建节点时，该节点具有profile_id属性，该属性指定在创建支持该节点的物理对象时要使用哪个Profile。所以在创建节点时，需要指定要使用的Profile的ID或名称。\n123456789101112131415161718192021222324252627openstack cluster node create --profile my_stack my_node+---------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+| Field         | Value                                                                                                                                                                                       |+---------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+| cluster_id    |                                                                                                                                                                                             || created_at    | None                                                                                                                                                                                        || data          | &#123;&#125;                                                                                                                                                                                          || dependents    | &#123;&#125;                                                                                                                                                                                          || details       | None                                                                                                                                                                                        || domain_id     | None                                                                                                                                                                                        || id            | 21b3e7dd-9f7f-4dea-93a0-9d03eb7b1236                                                                                                                                                        || index         | -1                                                                                                                                                                                          || init_at       | 2019-09-26T03:58:12Z                                                                                                                                                                        || location      | Munch(&#123;&#x27;project&#x27;: Munch(&#123;&#x27;domain_id&#x27;: None, &#x27;id&#x27;: u&#x27;f52380b8eb5345f0a568a186a5a832a5&#x27;, &#x27;name&#x27;: &#x27;admin&#x27;, &#x27;domain_name&#x27;: &#x27;Default&#x27;&#125;), &#x27;cloud&#x27;: &#x27;&#x27;, &#x27;region_name&#x27;: &#x27;RegionOne&#x27;, &#x27;zone&#x27;: None&#125;) || metadata      | &#123;&#125;                                                                                                                                                                                          || name          | my_node                                                                                                                                                                                     || physical_id   | None                                                                                                                                                                                        || profile_id    | ba4295d7-6800-4db4-8fe8-43ea978c91f9                                                                                                                                                        || profile_name  | my_stack                                                                                                                                                                                    || project_id    | f52380b8eb5345f0a568a186a5a832a5                                                                                                                                                            || role          |                                                                                                                                                                                             || status        | INIT                                                                                                                                                                                        || status_reason | Initializing                                                                                                                                                                                || updated_at    | None                                                                                                                                                                                        || user_id       | c1bb613f1ece4654b488c65fc0f62df8                                                                                                                                                            |+---------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n新节点的索引属性为-1。这是因为为节点指定所属集群。可以使用命令openstack cluster member add在节点创建后，为集群添加成员。当节点成为集群的成员时，它将为其索引属性获取一个值，该值可在所属集群中唯一标识其自身。\n\n\n在创建节点时指定拥有的集群：\n1openstack cluster node create --profile my_stack --cluster my_cluster my_node\n当指定拥有的群集时，senlin-engine将验证指定的群集Profile Type与新节点的Profile Type是否相同。如果配置文件类型不匹配，将会收到一个错误信息。\n\n\n创建新节点时，可能会用到的另一个参数是--role选项。创建一个主节点：\n1openstack cluster node create --profile my_stack --cluster my_cluster --role master master_node\n创建新节点时，可以指定的最后一个参数是--metadata选项。此选项的值是由分号（’;’）分隔的键值对的列表。这些键值对附加到节点，并且可以用于任何目的。\n1openstack cluster node create --profile my_stack --metadata owner=King my_node\n\n查看Nodes查看节点列表。\n\n\n查看详细Node查看节点详细信息。\n1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253openstack cluster node show node-TDqkLXqv                                                            +---------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+| Field         | Value                                                                                                                                                                                       |+---------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+| cluster_id    | eb5843d4-18c7-465f-bf65-76693f617f51                                                                                                                                                        || created_at    | 2019-09-26T06:19:55Z                                                                                                                                                                        || data          | &#123;&#125;                                                                                                                                                                                          || dependents    | &#123;&#125;                                                                                                                                                                                          || details       | None                                                                                                                                                                                        || domain_id     | None                                                                                                                                                                                        || id            | 2549b4ad-d29d-4a67-8bf3-c803538241d5                                                                                                                                                        || index         | 4                                                                                                                                                                                           || init_at       | 2019-09-26T06:19:49Z                                                                                                                                                                        || location      | Munch(&#123;&#x27;project&#x27;: Munch(&#123;&#x27;domain_id&#x27;: None, &#x27;id&#x27;: u&#x27;f52380b8eb5345f0a568a186a5a832a5&#x27;, &#x27;name&#x27;: &#x27;admin&#x27;, &#x27;domain_name&#x27;: &#x27;Default&#x27;&#125;), &#x27;cloud&#x27;: &#x27;&#x27;, &#x27;region_name&#x27;: &#x27;RegionOne&#x27;, &#x27;zone&#x27;: None&#125;) || metadata      | &#123;&#125;                                                                                                                                                                                          || name          | node-TDqkLXqv                                                                                                                                                                               || physical_id   | 7ceed7f7-84d3-44da-a767-95651602c5a3                                                                                                                                                        || profile_id    | ba4295d7-6800-4db4-8fe8-43ea978c91f9                                                                                                                                                        || profile_name  | my_stack                                                                                                                                                                                    || project_id    | f52380b8eb5345f0a568a186a5a832a5                                                                                                                                                            || role          | master                                                                                                                                                                                      || status        | ACTIVE                                                                                                                                                                                      || status_reason | Creation succeeded                                                                                                                                                                          || updated_at    | 2019-09-26T06:19:55Z                                                                                                                                                                        || user_id       | c1bb613f1ece4654b488c65fc0f62df8                                                                                                                                                            |+---------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------++---------------+------------------------------------------------+| Field         | Value                                          |+---------------+------------------------------------------------+| cluster_id    |                                                || created_at    | None                                           || data          | &#123;&#125;                                             || dependents    | &#123;&#125;                                             || details       | None                                           || domain_id     | None                                           || id            | 21b3e7dd-9f7f-4dea-93a0-9d03eb7b1236           || index         | -1                                             || init_at       | 2019-09-26T03:58:12Z                           || location      | None                                           || metadata      | &#123;&#125;                                             || name          | my_node                                        || physical_id   | None                                           || profile_id    | ba4295d7-6800-4db4-8fe8-43ea978c91f9           || profile_name  | my_stack                                       || project_id    | f52380b8eb5345f0a568a186a5a832a5               || role          |                                                || status        | INIT                                           || status_reason | Initializing                                   || updated_at    | None                                           || user_id       | c1bb613f1ece4654b488c65fc0f62df8               |+---------------+------------------------------------------------+\n从输出中，可以看到节点的physical_id（如果已成功创建）。对于不同的配置文件类型，此值可以是某种类型的对象的ID。例如，如果使用的配置文件类型为os.heat.stack，则表示Heat Stack ID；如果使用的配置文件类型是os.nova.server，则将给出Nova虚机ID。\n\n\n选项--details指定后，将得到有关支持该节点的物理对象的详细信息。\n1openstack cluster node show --details node-TDqkLXqv\n\n检查Nodesenlin-engine执行特定于配置文件的检查操作，以获取物理资源（例如虚拟机）的最新状态。如果虚拟机状态不是ACTIVE，则该节点将设置为ERROR状态。\n1openstack cluster node check my_node\n\n恢复Node创建节点并运行一段时间后，如果该节点进入ERROR状态，则可以使用命令尝试将其恢复为ACTIVE状态。恢复操作将删除指定的节点并重新创建它。\n1openstack cluster node recover my_node\n\n更新Node更新节点名称。\n1openstack cluster node update --name new_node_name old_node_name\n\n更改节点角色。\n1openstack cluster node update --role slave master_node\n\n更新元数据。\n1openstack cluster node update --metadata version=2.1 my_node\n\n更改节点的Profile。\n1openstack cluster node update --profile fedora21_server fedora20_server\n假设节点fedora20_server现在使用的是os.nova.server类型的配置文件，其中使用了Fedora 20镜像，经过上述命令，该节点将使用新的配置文件和Fedora 21镜像。\n\n\n生成Node在Senlin服务中，我们可以采用现有资源作为节点，并为此节点创建配置文件。要生成节点，您需要通过设置--identity来指定物理资源ID和设置–type来指定配置文件类型（Profile Type）。\n1234openstack cluster node adopt     --identity 1177c8e8-8472-4e9d-8f15-1d4866b85b8b \\    --type os.nova.server-1.0 \\    --name test_adopt_node\n--name是可选的，如果省略，senlin-engine将为该节点生成一个以node-开头的随机名称。--role和--metadata和创建节点时使用一致。\n\n\n--overrides支持用户可以覆盖节点的配置文件（Profile）的属性。\n1234openstack cluster node adopt     --identity 1177c8e8-8472-4e9d-8f15-1d4866b85b8b \\    --type os.nova.server-1.0 \\    --override &#x27;&#123;&quot;networks&quot;:[&#123;&quot;network&quot;: &quot;public&quot;&#125;]&#125;&#x27;\n\n--snapshot选项是布尔类型。如果设置，senlin-engine将在接受资源作为节点之前为资源创建快照。\n预览要生成的节点。要预览节点，您需要通过设置--identity来指定资源物理ID，并通过设置--type来指定资源Profile Type名称。\n1234openstack cluster node adopt     --identity 1177c8e8-8472-4e9d-8f15-1d4866b85b8b \\    --type os.nova.server-1.0 \\    --preview\n\n删除Node删除节点。\n1openstack cluster node delete my_node\n\nCluster Membership一个节点在任何时候最多可以属于一个集群。一个节点不属于任何群集时，称为孤立节点。创建节点时，可以使其成为集群的成员，也可以在创建集群和节点之后更改集群成员资格。\n查看Cluster成员1openstack cluster members list my_cluster\n\n\n增加Cluster成员1openstack cluster members add --nodes node3,node4 my_cluster\n\n移除Cluster成员1openstack cluster members del --nodes node21,node22 my_cluster\n从集群中删除节点后，它们的索引属性将重置为-1。\n\n\n替换Cluster成员用node22替换node21。\n1openstack cluster members replace --nodes node21=node22 my_cluster\n执行此操作时，senlin-engine将检查替换的节点是否是指定集群的成员。如果指定节点列表中的任何节点都不属于目标群集，则将收到错误消息，命令将失败。\n\n\nPolicy Type策略类型（Policy Type）是在包含特定配置文件类型（Profile Type）的节点的集群上，执行特定操作时要检查和执行的规则的规范。\n启动senlin-engine时，策略类型的注册表会建立在内存中。未来，Senlin将允许用户提供其他策略类型的实现，作为可动态加载的插件。\n策略类型的实现指明哪些字段是必需的，哪些字段是可选的，有时还会限制字段值。通过引用此策略类型创建策略时，将为这些字段分配具体值。例如，策略类型senlin.policy.deletion所需的属性：\n1234criteria: String # valid values - OLDEST_FIRST, YOUNGEST_FIRST, RANDOMdestroy_after_deletion: Booleangrace_period: Integerreduce_desired_capacity: Boolean\n\n此策略类型的策略对象的规范可能如下所示：\n1234567type: senlin.policy.deletionversion: 1.0properties:  criteria: OLDEST_FIRST  destroy_after_deletion: True  grace_period: 120  reduce_desired_capacity: True\n\n查看Policy Types1openstack cluster policy type list\n\n\n查看详细Policy Type查看Policy Type详细信息。\n1openstack cluster policy type show senlin.policy.health-1.0\n\nPolicy策略（Policy）是从策略类型（Policy Type）实例化的对象。创建之后，就可以将其动态附加到集群或从集群分离。策略通常包含要执行或已经执行某些动作时要检查和强制实施的规则。\n一个策略可以附加到许多集群，而一个集群可以附加许多策略。除此之外，还可以动态启用或禁用集群上的策略。\n创建Policy创建新的策略对象时，需要YAML格式的spec文件。还可能需要查看策略类型（Policy Type）中的属性名称和特定的策略类型。\nexamples/policies/deletion_policy.yaml\n12345678910111213141516171819# Sample deletion policy that can be attached to a cluster.type: senlin.policy.deletionversion: 1.0description: A policy for choosing victim node(s) from a cluster for deletion.properties:  # The valid values include:  # OLDEST_FIRST, OLDEST_PROFILE_FIRST, YOUNGEST_FIRST, RANDOM  criteria: OLDEST_FIRST  # Whether deleted node should be destroyed   destroy_after_deletion: True  # Length in number of seconds before the actual deletion happens  # This param buys an instance some time before deletion  grace_period: 60  # Whether the deletion will reduce the desired capacity of  # the cluster as well  reduce_desired_capacity: False\n创建Policy\n123456789101112131415161718192021222324252627openstack cluster policy create --spec deletion_policy.yaml my_policy+------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+| Field      | Value                                                                                                                                                                                       |+------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+| created_at | 2019-09-27T02:17:12.000000                                                                                                                                                                  || data       | &#123;&#125;                                                                                                                                                                                          || domain_id  | None                                                                                                                                                                                        || id         | 53d08309-236e-4e49-87b1-a913077b6c79                                                                                                                                                        || location   | Munch(&#123;&#x27;project&#x27;: Munch(&#123;&#x27;domain_id&#x27;: None, &#x27;id&#x27;: u&#x27;f52380b8eb5345f0a568a186a5a832a5&#x27;, &#x27;name&#x27;: &#x27;admin&#x27;, &#x27;domain_name&#x27;: &#x27;Default&#x27;&#125;), &#x27;cloud&#x27;: &#x27;&#x27;, &#x27;region_name&#x27;: &#x27;RegionOne&#x27;, &#x27;zone&#x27;: None&#125;) || name       | delete_policy                                                                                                                                                                               || project_id | f52380b8eb5345f0a568a186a5a832a5                                                                                                                                                            || spec       | &#123;                                                                                                                                                                                           ||            |   &quot;version&quot;: 1.0,                                                                                                                                                                           ||            |   &quot;type&quot;: &quot;senlin.policy.deletion&quot;,                                                                                                                                                         ||            |   &quot;description&quot;: &quot;A policy for choosing victim node(s) from a cluster for deletion.&quot;,                                                                                                       ||            |   &quot;properties&quot;: &#123;                                                                                                                                                                           ||            |     &quot;destroy_after_deletion&quot;: true,                                                                                                                                                         ||            |     &quot;grace_period&quot;: 60,                                                                                                                                                                     ||            |     &quot;reduce_desired_capacity&quot;: false,                                                                                                                                                       ||            |     &quot;criteria&quot;: &quot;OLDEST_FIRST&quot;                                                                                                                                                              ||            |   &#125;                                                                                                                                                                                         ||            | &#125;                                                                                                                                                                                           || type       | senlin.policy.deletion-1.0                                                                                                                                                                  || updated_at | None                                                                                                                                                                                        || user_id    | c1bb613f1ece4654b488c65fc0f62df8                                                                                                                                                            |+------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n查看Policies查看Policy列表。\n1openstack cluster policy list\n\n\n查看详细Policy查看Policy的详细信息。\n1openstack cluster policy show delete_policy\n\n更新Policy更改Policy的名称。\n1openstack cluster policy update --name my_policy delete_policy\n\n删除Policy1openstack cluster policy delete delete_policy\n\nCluster-Policy Binding可以同时将策略对象（Policy）附加到至少一个集群（Cluster）。集群在任何时候都可以连接多个策略对象。将策略对象附加到群集后，仍然可以启用或禁用它，或更新策略对象的某些属性。\n集群绑定策略Senlin允许将策略对象附加到集群，并动态地将其与集群分离。将策略对象附加到集群时，可以自定义特定集群的策略属性。\n1openstack cluster policy attach --policy delete_policy --enabled False my_cluster\n--enabled：布尔值，指示绑定的策略是否要启用。\n\n\n请注意，在大多数情况下，Senlin不允许将多个相同类型的策略附加到同一群集。对于某些策略类型，此限制已放宽。例如，在使用有关扩展的策略时，实际上可以将多个策略实例附加到同一群集，每个实例都与特定场景有关。\n\n\n查看集群策略查看指定集群的策略列表。\n1openstack cluster policy binding list my_cluster\n\n\n查看集群详细策略查看指定集群的指定策略的详细信息。\n123456789101112131415openstack cluster policy binding show  --policy delete_policy my_cluster+--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+| Field        | Value                                                                                                                                                                                       |+--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+| cluster_name | my_cluster                                                                                                                                                                                  || data         | None                                                                                                                                                                                        || id           | fbeef144-dae1-48c1-a78a-1d839fbccff9                                                                                                                                                        || is_enabled   | False                                                                                                                                                                                       || location     | Munch(&#123;&#x27;project&#x27;: Munch(&#123;&#x27;domain_id&#x27;: None, &#x27;id&#x27;: u&#x27;f52380b8eb5345f0a568a186a5a832a5&#x27;, &#x27;name&#x27;: &#x27;admin&#x27;, &#x27;domain_name&#x27;: &#x27;Default&#x27;&#125;), &#x27;cloud&#x27;: &#x27;&#x27;, &#x27;region_name&#x27;: &#x27;RegionOne&#x27;, &#x27;zone&#x27;: None&#125;) || name         | None                                                                                                                                                                                        || policy_id    | 53d08309-236e-4e49-87b1-a913077b6c79                                                                                                                                                        || policy_name  | delete_policy                                                                                                                                                                               || policy_type  | senlin.policy.deletion-1.0                                                                                                                                                                  |+--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n\n更新集群的策略更新指定集群的策略信息。\n123openstack cluster policy binding update \\    --enabled True \\    --policy my_delete my_cluster\n\n集群解绑策略1openstack cluster policy detach --policy my_delete mycluster\n\nReceiver接收器（Receiver）用于使senlin-engine准备好对外部警报或事件做出反应，以便可以在集群上自动启动特定的操作。例如，当集群上的负载上升时，Receiver可以更改指定集群的大小。\n创建Receiver目前，Senlin支持两种接收器类型：webhook和message。前者，将生成一个永久的Webhook网址，供用户通过发送HTTP POST请求在给定集群上触发特定操作。对于后者，将创建Zaqar消息队列，以供用户发布消息，此类消息用于通知Senlin服务以针对特定集群启动操作。\nWebhook Receiver创建类型为Webhook的Receiver。\n123456789101112131415161718192021222324openstack cluster receiver create --cluster my_cluster --action CLUSTER_SCALE_OUT --type webhook webhook_receiver+------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+| Field      | Value                                                                                                                                                                                       |+------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+| action     | CLUSTER_SCALE_OUT                                                                                                                                                                           || actor      | &#123;                                                                                                                                                                                           ||            |   &quot;trust_id&quot;: &quot;267bd0d37750422a92715b36257f1e85&quot;                                                                                                                                            ||            | &#125;                                                                                                                                                                                           || channel    | &#123;                                                                                                                                                                                           ||            |   &quot;alarm_url&quot;: &quot;http://192.168.10.20:8778/v1/webhooks/e00915bc-51ca-4a88-ade1-491327fb604c/trigger?V=1&quot;                                                                                     ||            | &#125;                                                                                                                                                                                           || cluster_id | eb5843d4-18c7-465f-bf65-76693f617f51                                                                                                                                                        || created_at | 2019-09-27T02:48:42Z                                                                                                                                                                        || domain_id  | None                                                                                                                                                                                        || id         | e00915bc-51ca-4a88-ade1-491327fb604c                                                                                                                                                        || location   | Munch(&#123;&#x27;project&#x27;: Munch(&#123;&#x27;domain_id&#x27;: None, &#x27;id&#x27;: u&#x27;f52380b8eb5345f0a568a186a5a832a5&#x27;, &#x27;name&#x27;: &#x27;admin&#x27;, &#x27;domain_name&#x27;: &#x27;Default&#x27;&#125;), &#x27;cloud&#x27;: &#x27;&#x27;, &#x27;region_name&#x27;: &#x27;RegionOne&#x27;, &#x27;zone&#x27;: None&#125;) || name       | webhook_receiver                                                                                                                                                                            || params     | &#123;&#125;                                                                                                                                                                                          || project_id | f52380b8eb5345f0a568a186a5a832a5                                                                                                                                                            || type       | webhook                                                                                                                                                                                     || updated_at | None                                                                                                                                                                                        || user_id    | c1bb613f1ece4654b488c65fc0f62df8                                                                                                                                                            |+------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n\n对于Webhook接收器，可以检查channel属性的alarm_url字段。可以使用此URL触发指定的操作。\n\n\n以下命令通过将POST请求发送到alarm_url来触发Receiver。\n1curl -X POST &lt;alarm_url&gt;\n\nMessage ReceiverMessage Receiver与Webhook Receiver的不同之处在于，它可以在不同的集群上触发不同的操作。因此，在创建Message Receiver时，可以省略选项--cluster和选项--action。Senlin将检查传入的消息是否包含此类属性。\n1openstack cluster receiver create --type message message-receiver\n创建消息接收器后，可以将以下格式的消息发送到命名的Zaqar队列，触发Receiver。\n123456789101112&#123;  &quot;messages&quot;: [    &#123;      &quot;ttl&quot;: 300,      &quot;body&quot;: &#123;        &quot;cluster&quot;: &quot;my-cluster&quot;,        &quot;action&quot;: &quot;CLUSTER_SCALE_IN&quot;,        &quot;params&quot;: &#123;&quot;count&quot;: 2&#125;      &#125;    &#125;  ]&#125;\n\nActionAction是可以在集群或节点上执行的操作。每个Action在创建后都由工作线程异步执行。除某些对象检索或对象列表API外，大多数Senlin API在senlin-engine内异步执行。\n不同类型的对象支持不同的动作集。例如，集群（Cluster）支持以下操作：\n\nCREATE: creates a cluster;\nDELETE: deletes a cluster;\nUPDATE: update the properties and/or the profile used by a cluster;\nADD_NODES: add existing nodes to a cluster;\nDEL_NODES: remove nodes from a cluster;\nATTACH_POLICY: attach the specified policy to a cluster;\nDETACH_POLICY: detach the specified policy from a cluster;\nUPDATE_POLICY: update the specified policy on a cluster;\nSCALE_IN: shrink the size of a cluster;\nSCALE_OUT: inflate the size of a cluster;\nRESIZE: resize a cluster;\nCHECK: check a cluster;\nRECOVER: recover a cluster;\nREPLACE_NODES: replace the nodes in cluster with specified nodes;\nOPERATION: perform an operation on the specified cluster;\n\n节点（Node）支持以下操作：\n\nCREATE: creates a node;\nDELETE: deletes a node;\nUPDATE: updates the properties and/or the profile used by a node;\nCHECK: check a node;\nRECOVER: recover a node;\nOPERATION: perform an operation on the specified node;\n\n查看Actions查看Action列表。\n1openstack cluster action list \n\n\n查看详细Action查看Action的详细信息。\n1234567891011121314151617181920212223242526272829openstack cluster action show c3bee157+---------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+| Field         | Value                                                                                                                                                                                       |+---------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+| action        | CLUSTER_CREATE                                                                                                                                                                              || cause         | RPC Request                                                                                                                                                                                 || created_at    | 2019-09-25T09:20:40Z                                                                                                                                                                        || depended_by   |                                                                                                                                                                                             || depends_on    |                                                                                                                                                                                             || domain_id     | None                                                                                                                                                                                        || end_at        | 1569403240.87                                                                                                                                                                               || id            | c3bee157-00fd-4330-a049-3a3feb0cd593                                                                                                                                                        || inputs        | &#123;&#125;                                                                                                                                                                                          || interval      | -1                                                                                                                                                                                          || location      | Munch(&#123;&#x27;project&#x27;: Munch(&#123;&#x27;domain_id&#x27;: None, &#x27;id&#x27;: u&#x27;f52380b8eb5345f0a568a186a5a832a5&#x27;, &#x27;name&#x27;: &#x27;admin&#x27;, &#x27;domain_name&#x27;: &#x27;Default&#x27;&#125;), &#x27;cloud&#x27;: &#x27;&#x27;, &#x27;region_name&#x27;: &#x27;RegionOne&#x27;, &#x27;zone&#x27;: None&#125;) || name          | cluster_create_eb5843d4                                                                                                                                                                     || outputs       | &#123;&#125;                                                                                                                                                                                          || owner_id      | None                                                                                                                                                                                        || project_id    | f52380b8eb5345f0a568a186a5a832a5                                                                                                                                                            || start_at      | 1569403240.47                                                                                                                                                                               || status        | SUCCEEDED                                                                                                                                                                                   || status_reason | Action completed successfully.                                                                                                                                                              || target_id     | eb5843d4-18c7-465f-bf65-76693f617f51                                                                                                                                                        || timeout       | 3600                                                                                                                                                                                        || updated_at    | None                                                                                                                                                                                        || user_id       | c1bb613f1ece4654b488c65fc0f62df8                                                                                                                                                            |+---------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n\nEvent事件（Event）是senlin-engine执行期间生成的记录。senlin-engine服务在执行某些操作或检查策略时会生成事件记录。\n事件（Event）具有级别属性，可以将其解释为事件的严重性级别值：\n\n10: interpreted as DEBUG level. Events at this level can be ignored safely by users. For developers they may provide some useful information for debugging the code.\n20: interpreted as INFO level. Events at this level are mostly about notifying that some operations have been successfully performed.\n30: interpreted as WARNING level. Events at this level are used to signal some unhealthy status or anomalies detected by the engine. These events should be monitored and checked when operating a cluster.\n40: interpreted as ERROR level. Events at this level signifies some failures in engine operations. These event should be monitored and checked when operating a cluster. Usually some user intervention is expected to recover a cluster from this status.\n50: interpreted as CRITICAL level. Events at this level are about serious problems encountered by the engine. The engine service may have run into some bugs. User intervention is required to do a recovery.\n\nEvent Dispatcher ConfigurationSenlin提供了用于事件调度的开放式体系结构。内置调度程序中的两个是数据库和消息。\n\n数据库调度程序将事件转储到数据库表中，并且默认情况下启用。\n\n消息调度程序将事件对象转换为版本化的事件通知，并发布在全局消息队列中。默认情况下，禁用此调度程序。要启用它，可以将以下行添加到senlin.conf文件的[DEFAULT]部分，然后重新启动senlin-engine：\n12[default]event_dispatchers = message\n根据部署设置，使用消息分发程序时，还必须将以下行添加到senlin.conf文件中。这些行将消息传递设置为oslo.messaging软件包使用的默认驱动程序：\n12[oslo_messaging_notifications]driver = messaging\n使用此配置，数据库分发程序将被禁用，这意味着您只能通过消息队列访问事件。\n\nevent_dispatchers字段为MultiString时，如果需要，可以同时启用数据库分发程序和消息分发程序：\n123456[default]event_dispatchers = databaseevent_dispatchers = message[oslo_messaging_notifications]driver = messaging\n\n\n\n请注意，默认情况下，与TTL（生存时间）值不相关的未处理事件通知将保留在消息总线上，在启用消息分派器之前，请确保Senlin事件通知将被某些服务订阅并处理。\n\n\nBy default, we use the senlin exchange which type is TOPIC to route the notifications to queues with different routing_key. The queues name could be versioned_notifications.debug, versioned_notifications.info, versioned_notifications.warn and versioned_notifications.error that depends on the log level you are using in senlin.conf. The corresponding routing_key are the same as the queues’ name.\nThere are two options to consume the notifications:\n\nConsume the notifications from the default queues directlly.\nDeclare your own queues, then bind them to senlin exchange with corresponding routing_key to customize the flow.\n\n查看Events查看Event列表。\n1openstack cluster event list\n\n\n查看详细Event查看Event的详细信息。\n1234567891011121314151617181920openstack cluster event show 932d0009                                                                +---------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+| Field         | Value                                                                                                                                                                                       |+---------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+| action        | CLUSTER_CREATE                                                                                                                                                                              || cluster_id    | eb5843d4-18c7-465f-bf65-76693f617f51                                                                                                                                                        || generated_at  | 2019-09-25T09:20:40+00:00                                                                                                                                                                   || id            | 932d0009-286f-40e1-81e0-3b44a41657da                                                                                                                                                        || level         | INFO                                                                                                                                                                                        || location      | Munch(&#123;&#x27;project&#x27;: Munch(&#123;&#x27;domain_id&#x27;: None, &#x27;id&#x27;: u&#x27;f52380b8eb5345f0a568a186a5a832a5&#x27;, &#x27;name&#x27;: &#x27;admin&#x27;, &#x27;domain_name&#x27;: &#x27;Default&#x27;&#125;), &#x27;cloud&#x27;: &#x27;&#x27;, &#x27;region_name&#x27;: &#x27;RegionOne&#x27;, &#x27;zone&#x27;: None&#125;) || name          | None                                                                                                                                                                                        || obj_id        | eb5843d4-18c7-465f-bf65-76693f617f51                                                                                                                                                        || obj_name      | my_cluster                                                                                                                                                                                  || obj_type      | CLUSTER                                                                                                                                                                                     || project_id    | f52380b8eb5345f0a568a186a5a832a5                                                                                                                                                            || status        | start                                                                                                                                                                                       || status_reason | c3bee157                                                                                                                                                                                    || user_id       | c1bb613f1ece4654b488c65fc0f62df8                                                                                                                                                            |+---------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+","dateCreated":"2019-09-25T10:47:04+08:00","dateModified":"2023-09-21T10:45:00+08:00","datePublished":"2019-09-25T10:47:04+08:00","description":"Senlin是针对OpenStack云的集群服务。它创建并操作其他OpenStack服务公开的同类对象的集群。目的是使编排相似对象的过程更容易。","headline":"OpenStack Senlin集群即服务","image":[null,"images/PROJECT-Vayne.jpg"],"mainEntityOfPage":{"@type":"WebPage","@id":"https://wangkuntian.github.io/2019/09/25/OpenStack-Senlin%E9%9B%86%E7%BE%A4%E5%8D%B3%E6%9C%8D%E5%8A%A1/"},"publisher":{"@type":"Organization","name":"Wang kuntian","sameAs":["https://github.com/wangkuntian","mailto:wangkuntian1994@163.com"],"image":"faker.jpg","logo":{"@type":"ImageObject","url":"faker.jpg"}},"url":"https://wangkuntian.github.io/2019/09/25/OpenStack-Senlin%E9%9B%86%E7%BE%A4%E5%8D%B3%E6%9C%8D%E5%8A%A1/","keywords":"OpenStack, Senlin","thumbnailUrl":"images/PROJECT-Vayne.jpg"}</script>
    <meta name="description" content="Senlin是针对OpenStack云的集群服务。它创建并操作其他OpenStack服务公开的同类对象的集群。目的是使编排相似对象的过程更容易。">
<meta property="og:type" content="blog">
<meta property="og:title" content="OpenStack Senlin集群即服务">
<meta property="og:url" content="https://wangkuntian.github.io/2019/09/25/OpenStack-Senlin%E9%9B%86%E7%BE%A4%E5%8D%B3%E6%9C%8D%E5%8A%A1/index.html">
<meta property="og:site_name" content="Wang kuntian&#39;s Blog">
<meta property="og:description" content="Senlin是针对OpenStack云的集群服务。它创建并操作其他OpenStack服务公开的同类对象的集群。目的是使编排相似对象的过程更容易。">
<meta property="og:locale" content="zh_EN">
<meta property="og:image" content="https://wangkuntian.github.io/2019/09/25/OpenStack-Senlin%E9%9B%86%E7%BE%A4%E5%8D%B3%E6%9C%8D%E5%8A%A1/images/profile-type-list.png">
<meta property="og:image" content="https://wangkuntian.github.io/2019/09/25/OpenStack-Senlin%E9%9B%86%E7%BE%A4%E5%8D%B3%E6%9C%8D%E5%8A%A1/images/profile-list.png">
<meta property="og:image" content="https://wangkuntian.github.io/2019/09/25/OpenStack-Senlin%E9%9B%86%E7%BE%A4%E5%8D%B3%E6%9C%8D%E5%8A%A1/images/cluster-list.png">
<meta property="og:image" content="https://wangkuntian.github.io/2019/09/25/OpenStack-Senlin%E9%9B%86%E7%BE%A4%E5%8D%B3%E6%9C%8D%E5%8A%A1/images/cluster-check.png">
<meta property="og:image" content="https://wangkuntian.github.io/2019/09/25/OpenStack-Senlin%E9%9B%86%E7%BE%A4%E5%8D%B3%E6%9C%8D%E5%8A%A1/images/node-list.png">
<meta property="og:image" content="https://wangkuntian.github.io/2019/09/25/OpenStack-Senlin%E9%9B%86%E7%BE%A4%E5%8D%B3%E6%9C%8D%E5%8A%A1/images/members-list.png">
<meta property="og:image" content="https://wangkuntian.github.io/2019/09/25/OpenStack-Senlin%E9%9B%86%E7%BE%A4%E5%8D%B3%E6%9C%8D%E5%8A%A1/images/policy-type-list.png">
<meta property="og:image" content="https://wangkuntian.github.io/2019/09/25/OpenStack-Senlin%E9%9B%86%E7%BE%A4%E5%8D%B3%E6%9C%8D%E5%8A%A1/images/policy-list.png">
<meta property="og:image" content="https://wangkuntian.github.io/2019/09/25/OpenStack-Senlin%E9%9B%86%E7%BE%A4%E5%8D%B3%E6%9C%8D%E5%8A%A1/images/policy-binding-list.png">
<meta property="og:image" content="https://wangkuntian.github.io/2019/09/25/OpenStack-Senlin%E9%9B%86%E7%BE%A4%E5%8D%B3%E6%9C%8D%E5%8A%A1/images/action-list.png">
<meta property="og:image" content="https://wangkuntian.github.io/2019/09/25/OpenStack-Senlin%E9%9B%86%E7%BE%A4%E5%8D%B3%E6%9C%8D%E5%8A%A1/images/event-list.png">
<meta property="article:published_time" content="2019-09-25T02:47:04.000Z">
<meta property="article:modified_time" content="2023-09-21T02:45:00.039Z">
<meta property="article:author" content="Wang kuntian">
<meta property="article:tag" content="OpenStack">
<meta property="article:tag" content="Senlin">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://wangkuntian.github.io/2019/09/25/OpenStack-Senlin%E9%9B%86%E7%BE%A4%E5%8D%B3%E6%9C%8D%E5%8A%A1/images/profile-type-list.png">
    
    
        
    
    
        <meta property="og:image" content="https://wangkuntian.github.io/assets/images/faker.jpg"/>
    
    
    
        <meta property="og:image" content="https://wangkuntian.github.io/2019/09/25/OpenStack-Senlin%E9%9B%86%E7%BE%A4%E5%8D%B3%E6%9C%8D%E5%8A%A1/images/PROJECT-Vayne.jpg"/>
        <meta class="swiftype" name="image" data-type="enum" content="https://wangkuntian.github.io/2019/09/25/OpenStack-Senlin%E9%9B%86%E7%BE%A4%E5%8D%B3%E6%9C%8D%E5%8A%A1/images/PROJECT-Vayne.jpg"/>
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/style-bkzaqwnhdy35ne9gawopbfxp7lltc7yhde0uckf6kikurfjo9ztq2v5apuqa.min.css">

    <!--STYLES END-->
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-136102260-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-136102260-1');
    </script>


    

    
        
    
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --></head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="4">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            Wang kuntian&#39;s Blog
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="Öffne den Link: /#about"
            >
        
        
            <img class="header-picture" src="/assets/images/faker.jpg" alt="Author&#39;s picture"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="4">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="Lesen Sie mehr über den Autor"
                >
                    <img class="sidebar-profile-picture" src="/assets/images/faker.jpg" alt="Author&#39;s picture"/>
                </a>
                <h4 class="sidebar-profile-name">Wang kuntian</h4>
                
                    <h5 class="sidebar-profile-bio"><p>Hi</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="Categories"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="Tags"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-archives"
                            
                            rel="noopener"
                            title="Archives"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Archives</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link open-algolia-search"
                            href="#search"
                            
                            rel="noopener"
                            title="Search"
                        >
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Search</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="About"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/wangkuntian"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="mailto:wangkuntian1994@163.com"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Mail"
                        >
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Mail</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/atom.xml"
                            
                            rel="noopener"
                            title="RSS"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
        <div class="post-header-cover
                    text-center
                    post-header-cover--full"
             style="background-image:url('/images/PROJECT-Vayne.jpg');"
             data-behavior="4">
            
                <div class="post-header main-content-wrap text-center">
    
        <h1 class="post-title">
            OpenStack Senlin集群即服务
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2019-09-25T10:47:04+08:00">
	
		    Sep 25, 2019
    	
    </time>
    
</div>

    
</div>

            
        </div>

            <div id="main" data-behavior="4"
                 class="hasCover
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <p>Senlin是针对OpenStack云的集群服务。它创建并操作其他OpenStack服务公开的同类对象的集群。目的是使编排相似对象的过程更容易。</p>
<span id="more"></span>
<h1 id="table-of-contents">目录</h1><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6"><span class="toc-text">组件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#senlinclient"><span class="toc-text">senlinclient</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#senlin-dashboard"><span class="toc-text">senlin-dashboard</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#senlin-api"><span class="toc-text">senlin-api</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#senlin-engine"><span class="toc-text">senlin-engine</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5"><span class="toc-text">概念</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Profile-Type"><span class="toc-text">Profile Type</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8BProfile-Types"><span class="toc-text">查看Profile Types</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E8%AF%A6%E7%BB%86Profile-Type"><span class="toc-text">查看详细Profile Type</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8BProfile-Type%E6%93%8D%E4%BD%9C"><span class="toc-text">查看Profile Type操作</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Profile"><span class="toc-text">Profile</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAProfile"><span class="toc-text">创建Profile</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8BProfiles"><span class="toc-text">查看Profiles</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E8%AF%A6%E7%BB%86Profile"><span class="toc-text">查看详细Profile</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0Profile"><span class="toc-text">更新Profile</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%A0%E9%99%A4Profile"><span class="toc-text">删除Profile</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Cluster"><span class="toc-text">Cluster</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%9B%E5%BB%BACluster"><span class="toc-text">创建Cluster</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E9%9B%86%E7%BE%A4%E5%AE%B9%E9%87%8F"><span class="toc-text">集群容量</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E5%B1%9E%E6%80%A7"><span class="toc-text">其他属性</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8BClusters"><span class="toc-text">查看Clusters</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E8%AF%A6%E7%BB%86Cluster"><span class="toc-text">查看详细Cluster</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0Cluster"><span class="toc-text">更新Cluster</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%B0%83%E6%95%B4Cluster%E5%A4%A7%E5%B0%8F"><span class="toc-text">调整Cluster大小</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#capacity"><span class="toc-text">capacity</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#adjustment"><span class="toc-text">adjustment</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#percentage"><span class="toc-text">percentage</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#min-step"><span class="toc-text">min-step</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#strict"><span class="toc-text">strict</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Cluster%E4%BC%B8%E7%BC%A9"><span class="toc-text">Cluster伸缩</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5Cluster"><span class="toc-text">检查Cluster</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%81%A2%E5%A4%8DCluster"><span class="toc-text">恢复Cluster</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%A0%E9%99%A4Cluster"><span class="toc-text">删除Cluster</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Node"><span class="toc-text">Node</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%9B%E5%BB%BANode"><span class="toc-text">创建Node</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8BNodes"><span class="toc-text">查看Nodes</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E8%AF%A6%E7%BB%86Node"><span class="toc-text">查看详细Node</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5Node"><span class="toc-text">检查Node</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%81%A2%E5%A4%8DNode"><span class="toc-text">恢复Node</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0Node"><span class="toc-text">更新Node</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%94%9F%E6%88%90Node"><span class="toc-text">生成Node</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%A0%E9%99%A4Node"><span class="toc-text">删除Node</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Cluster-Membership"><span class="toc-text">Cluster Membership</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8BCluster%E6%88%90%E5%91%98"><span class="toc-text">查看Cluster成员</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A2%9E%E5%8A%A0Cluster%E6%88%90%E5%91%98"><span class="toc-text">增加Cluster成员</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A7%BB%E9%99%A4Cluster%E6%88%90%E5%91%98"><span class="toc-text">移除Cluster成员</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9B%BF%E6%8D%A2Cluster%E6%88%90%E5%91%98"><span class="toc-text">替换Cluster成员</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Policy-Type"><span class="toc-text">Policy Type</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8BPolicy-Types"><span class="toc-text">查看Policy Types</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E8%AF%A6%E7%BB%86Policy-Type"><span class="toc-text">查看详细Policy Type</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Policy"><span class="toc-text">Policy</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAPolicy"><span class="toc-text">创建Policy</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8BPolicies"><span class="toc-text">查看Policies</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E8%AF%A6%E7%BB%86Policy"><span class="toc-text">查看详细Policy</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0Policy"><span class="toc-text">更新Policy</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%A0%E9%99%A4Policy"><span class="toc-text">删除Policy</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Cluster-Policy-Binding"><span class="toc-text">Cluster-Policy Binding</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%9B%86%E7%BE%A4%E7%BB%91%E5%AE%9A%E7%AD%96%E7%95%A5"><span class="toc-text">集群绑定策略</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E9%9B%86%E7%BE%A4%E7%AD%96%E7%95%A5"><span class="toc-text">查看集群策略</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E9%9B%86%E7%BE%A4%E8%AF%A6%E7%BB%86%E7%AD%96%E7%95%A5"><span class="toc-text">查看集群详细策略</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E9%9B%86%E7%BE%A4%E7%9A%84%E7%AD%96%E7%95%A5"><span class="toc-text">更新集群的策略</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%9B%86%E7%BE%A4%E8%A7%A3%E7%BB%91%E7%AD%96%E7%95%A5"><span class="toc-text">集群解绑策略</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Receiver"><span class="toc-text">Receiver</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAReceiver"><span class="toc-text">创建Receiver</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Webhook-Receiver"><span class="toc-text">Webhook Receiver</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Message-Receiver"><span class="toc-text">Message Receiver</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Action"><span class="toc-text">Action</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8BActions"><span class="toc-text">查看Actions</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E8%AF%A6%E7%BB%86Action"><span class="toc-text">查看详细Action</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Event"><span class="toc-text">Event</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Event-Dispatcher-Configuration"><span class="toc-text">Event Dispatcher Configuration</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8BEvents"><span class="toc-text">查看Events</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E8%AF%A6%E7%BB%86Event"><span class="toc-text">查看详细Event</span></a></li></ol></li></ol></li></ol>

<p>Senlin与其他OpenStack服务进行交互，以便可以创建和操作这些服务公开的资源集群。这些交互主要通过配置文件插件完成。每个配置文件类型的实现都使Senlin能够创建，更新，删除特定类型的资源。</p>
<p>集群（<strong>Cluster</strong>）可以与不同的策略（<strong>Policy</strong>）对象相关联，可以在不同的实施级别上对其进行检查/实施。通过服务API，用户可以动态地将节点（<strong>Node</strong>）添加到集群中或从集群中删除节点，以及附加和分离策略，例如创建策略，删除策略，负载均衡策略，扩展策略，健康状况策略等。通过与其他OpenStack项目集成，可以使用户更轻松地管理大型资源池的部署和业务流程。</p>
<p>Senlin被设计为能够管理不同类型的对象。使用配置文件类型（<strong>Profile Type</strong>）实现管理对象的生命周期，这些实现是可以由服务引擎动态加载的插件。</p>
<h3 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h3><h4 id="senlinclient"><a href="#senlinclient" class="headerlink" title="senlinclient"></a>senlinclient</h4><p>senlinclient软件包为openstackclient工具提供了一个插件，因此您具有命令行界面，可与senlin-api通信以管理集群，节点，配置文件，策略，操作（<strong>Action</strong>）和事件（<strong>Event</strong>）。</p>
<h4 id="senlin-dashboard"><a href="#senlin-dashboard" class="headerlink" title="senlin-dashboard"></a>senlin-dashboard</h4><p>senlin-dashboard是一个Horizo​​n插件，可为Senlin提供UI。</p>
<h4 id="senlin-api"><a href="#senlin-api" class="headerlink" title="senlin-api"></a>senlin-api</h4><p>senlin-api组件提供了OpenStack本机REST API，该API通过RPC将API请求发送到senlin-engine来处理API请求。</p>
<h4 id="senlin-engine"><a href="#senlin-engine" class="headerlink" title="senlin-engine"></a>senlin-engine</h4><p>senlin-engine的主要职责是创建和编排集群，节点，配置文件和策略。</p>
<h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><h4 id="Profile-Type"><a href="#Profile-Type" class="headerlink" title="Profile Type"></a>Profile Type</h4><p>配置文件类型（<strong>Profile Type</strong>）可以视为配置文件（<strong>Profile</strong>）对象的元类型。启动senlin-engine时，Profile Type的注册表会建立在内存中。未来，Senlin将允许用户提供其他配置文件类型的实现，作为可动态加载的插件。</p>
<p>Profile Type的实现指出需要哪些字段。通过引用此Profile Type创建Profile时，将为字段分配具体值。</p>
<h5 id="查看Profile-Types"><a href="#查看Profile-Types" class="headerlink" title="查看Profile Types"></a>查看Profile Types</h5><p>查看Senlin服务器支持的Profile Type的列表。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster profile <span class="built_in">type</span> list</span><br></pre></td></tr></table></figure>
<div class="figure " style="width:;"><a class="fancybox" href="images/profile-type-list.png" title="" data-caption="" data-fancybox="default"><img class="fig-img" src="images/profile-type-list.png" alt=""></a></div>

<h5 id="查看详细Profile-Type"><a href="#查看详细Profile-Type" class="headerlink" title="查看详细Profile Type"></a>查看详细Profile Type</h5><p>每个Profile Type都有一个用于其规范的架构，该架构描述了可以接受的名称和属性类型。要显示特定Profile Type的架构以及其他属性，可以使用下面的命令。</p>
<p>os.heat.stack</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster profile <span class="built_in">type</span> show os.heat.stack-1.0</span><br><span class="line"></span><br><span class="line">support_status:</span><br><span class="line">  <span class="string">&#x27;1.0&#x27;</span>:</span><br><span class="line">  - since: <span class="string">&#x27;2016.04&#x27;</span></span><br><span class="line">    status: SUPPORTED</span><br><span class="line"><span class="built_in">id</span>: os.heat.stack-1.0</span><br><span class="line">location:</span><br><span class="line">  cloud: <span class="string">&#x27;&#x27;</span></span><br><span class="line">  project:</span><br><span class="line">    domain_id: null</span><br><span class="line">    domain_name: Default</span><br><span class="line">    <span class="built_in">id</span>: f52380b8eb5345f0a568a186a5a832a5</span><br><span class="line">    name: admin</span><br><span class="line">  region_name: RegionOne</span><br><span class="line">  zone: null</span><br><span class="line">name: os.heat.stack-1.0</span><br><span class="line">schema:</span><br><span class="line">  context:</span><br><span class="line">    default: &#123;&#125;</span><br><span class="line">    description: A dictionary <span class="keyword">for</span> specifying the customized context <span class="keyword">for</span> stack operations.</span><br><span class="line">    required: <span class="literal">false</span></span><br><span class="line">    <span class="built_in">type</span>: Map</span><br><span class="line">    updatable: <span class="literal">false</span></span><br><span class="line">  disable_rollback:</span><br><span class="line">    default: <span class="literal">true</span></span><br><span class="line">    description: A boolean specifying whether a stack operation can be rolled back.</span><br><span class="line">    required: <span class="literal">false</span></span><br><span class="line">    <span class="built_in">type</span>: Boolean</span><br><span class="line">    updatable: <span class="literal">true</span></span><br><span class="line">  environment:</span><br><span class="line">    default: &#123;&#125;</span><br><span class="line">    description: A map that specifies the environment used <span class="keyword">for</span> stack operations.</span><br><span class="line">    required: <span class="literal">false</span></span><br><span class="line">    <span class="built_in">type</span>: Map</span><br><span class="line">    updatable: <span class="literal">true</span></span><br><span class="line">  files:</span><br><span class="line">    default: &#123;&#125;</span><br><span class="line">    description: Contents of files referenced by the template, <span class="keyword">if</span> any.</span><br><span class="line">    required: <span class="literal">false</span></span><br><span class="line">    <span class="built_in">type</span>: Map</span><br><span class="line">    updatable: <span class="literal">true</span></span><br><span class="line">  parameters:</span><br><span class="line">    default: &#123;&#125;</span><br><span class="line">    description: Parameters to be passed to Heat <span class="keyword">for</span> stack operations.</span><br><span class="line">    required: <span class="literal">false</span></span><br><span class="line">    <span class="built_in">type</span>: Map</span><br><span class="line">    updatable: <span class="literal">true</span></span><br><span class="line">  template:</span><br><span class="line">    default: &#123;&#125;</span><br><span class="line">    description: Heat stack template.</span><br><span class="line">    required: <span class="literal">false</span></span><br><span class="line">    <span class="built_in">type</span>: Map</span><br><span class="line">    updatable: <span class="literal">true</span></span><br><span class="line">  template_url:</span><br><span class="line">    default: <span class="string">&#x27;&#x27;</span></span><br><span class="line">    description: Heat stack template url.</span><br><span class="line">    required: <span class="literal">false</span></span><br><span class="line">    <span class="built_in">type</span>: String</span><br><span class="line">    updatable: <span class="literal">true</span></span><br><span class="line">  <span class="built_in">timeout</span>:</span><br><span class="line">    description: A <span class="built_in">integer</span> that specifies the number of minutes that a stack operation</span><br><span class="line">      <span class="built_in">times</span> out.</span><br><span class="line">    required: <span class="literal">false</span></span><br><span class="line">    <span class="built_in">type</span>: Integer</span><br><span class="line">    updatable: <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>os.nova.server</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster profile <span class="built_in">type</span> show os.nova.server-1.0</span><br><span class="line"></span><br><span class="line">support_status:</span><br><span class="line">  <span class="string">&#x27;1.0&#x27;</span>:</span><br><span class="line">  - since: <span class="string">&#x27;2016.04&#x27;</span></span><br><span class="line">    status: SUPPORTED</span><br><span class="line"><span class="built_in">id</span>: os.nova.server-1.0</span><br><span class="line">location:</span><br><span class="line">  cloud: <span class="string">&#x27;&#x27;</span></span><br><span class="line">  project:</span><br><span class="line">    domain_id: null</span><br><span class="line">    domain_name: Default</span><br><span class="line">    <span class="built_in">id</span>: f52380b8eb5345f0a568a186a5a832a5</span><br><span class="line">    name: admin</span><br><span class="line">  region_name: RegionOne</span><br><span class="line">  zone: null</span><br><span class="line">name: os.nova.server-1.0</span><br><span class="line">schema:</span><br><span class="line">  admin_pass:</span><br><span class="line">    description: Password <span class="keyword">for</span> the administrator account.</span><br><span class="line">    required: <span class="literal">false</span></span><br><span class="line">    <span class="built_in">type</span>: String</span><br><span class="line">    updatable: <span class="literal">false</span></span><br><span class="line">  auto_disk_config:</span><br><span class="line">    default: <span class="literal">true</span></span><br><span class="line">    description: Whether the disk partition is <span class="keyword">done</span> automatically.</span><br><span class="line">    required: <span class="literal">false</span></span><br><span class="line">    <span class="built_in">type</span>: Boolean</span><br><span class="line">    updatable: <span class="literal">false</span></span><br><span class="line">  availability_zone:</span><br><span class="line">    description: Name of availability zone <span class="keyword">for</span> running the server.</span><br><span class="line">    required: <span class="literal">false</span></span><br><span class="line">    <span class="built_in">type</span>: String</span><br><span class="line">    updatable: <span class="literal">false</span></span><br><span class="line">  block_device_mapping_v2:</span><br><span class="line">    description: A list specifying the properties of block devices to be used <span class="keyword">for</span></span><br><span class="line">      this server.</span><br><span class="line">    required: <span class="literal">false</span></span><br><span class="line">    schema:</span><br><span class="line">      <span class="string">&#x27;*&#x27;</span>:</span><br><span class="line">        description: A map specifying the properties of a block device to be used</span><br><span class="line">          by the server.</span><br><span class="line">        required: <span class="literal">false</span></span><br><span class="line">        schema:</span><br><span class="line">          boot_index:</span><br><span class="line">            description: Define the boot order of the device</span><br><span class="line">            required: <span class="literal">false</span></span><br><span class="line">            <span class="built_in">type</span>: Integer</span><br><span class="line">            updatable: <span class="literal">false</span></span><br><span class="line">          delete_on_termination:</span><br><span class="line">            description: Whether to delete the volume when the server stops.</span><br><span class="line">            required: <span class="literal">false</span></span><br><span class="line">            <span class="built_in">type</span>: Boolean</span><br><span class="line">            updatable: <span class="literal">false</span></span><br><span class="line">          destination_type:</span><br><span class="line">            description: Volume destination <span class="built_in">type</span>, must be <span class="string">&#x27;volume&#x27;</span> or <span class="string">&#x27;local&#x27;</span></span><br><span class="line">            required: <span class="literal">true</span></span><br><span class="line">            <span class="built_in">type</span>: String</span><br><span class="line">            updatable: <span class="literal">false</span></span><br><span class="line">          device_name:</span><br><span class="line">            description: Name of the device(e.g. vda, xda, ....).</span><br><span class="line">            required: <span class="literal">false</span></span><br><span class="line">            <span class="built_in">type</span>: String</span><br><span class="line">            updatable: <span class="literal">false</span></span><br><span class="line">          device_type:</span><br><span class="line">            description: Type of the device(e.g. disk, cdrom, ...).</span><br><span class="line">            required: <span class="literal">false</span></span><br><span class="line">            <span class="built_in">type</span>: String</span><br><span class="line">            updatable: <span class="literal">false</span></span><br><span class="line">          disk_bus:</span><br><span class="line">            description: Bus of the device.</span><br><span class="line">            required: <span class="literal">false</span></span><br><span class="line">            <span class="built_in">type</span>: String</span><br><span class="line">            updatable: <span class="literal">false</span></span><br><span class="line">          guest_format:</span><br><span class="line">            description: Specifies the disk file system format(e.g. swap, ephemeral,</span><br><span class="line">              ...).</span><br><span class="line">            required: <span class="literal">false</span></span><br><span class="line">            <span class="built_in">type</span>: String</span><br><span class="line">            updatable: <span class="literal">false</span></span><br><span class="line">          source_type:</span><br><span class="line">            description: Volume <span class="built_in">source</span> <span class="built_in">type</span>, must be one of <span class="string">&#x27;image&#x27;</span>, <span class="string">&#x27;snapshot&#x27;</span>, <span class="string">&#x27;volume&#x27;</span></span><br><span class="line">              or <span class="string">&#x27;blank&#x27;</span></span><br><span class="line">            required: <span class="literal">true</span></span><br><span class="line">            <span class="built_in">type</span>: String</span><br><span class="line">            updatable: <span class="literal">false</span></span><br><span class="line">          uuid:</span><br><span class="line">            description: ID of the <span class="built_in">source</span> image, snapshot or volume</span><br><span class="line">            required: <span class="literal">false</span></span><br><span class="line">            <span class="built_in">type</span>: String</span><br><span class="line">            updatable: <span class="literal">false</span></span><br><span class="line">          volume_size:</span><br><span class="line">            description: Size of the block device <span class="keyword">in</span> MB(<span class="keyword">for</span> swap) and <span class="keyword">in</span> GB(<span class="keyword">for</span> other</span><br><span class="line">              formats)</span><br><span class="line">            required: <span class="literal">true</span></span><br><span class="line">            <span class="built_in">type</span>: Integer</span><br><span class="line">            updatable: <span class="literal">false</span></span><br><span class="line">        <span class="built_in">type</span>: Map</span><br><span class="line">        updatable: <span class="literal">false</span></span><br><span class="line">    <span class="built_in">type</span>: List</span><br><span class="line">    updatable: <span class="literal">false</span></span><br><span class="line">  config_drive:</span><br><span class="line">    description: Whether config drive should be enabled <span class="keyword">for</span> the server.</span><br><span class="line">    required: <span class="literal">false</span></span><br><span class="line">    <span class="built_in">type</span>: Boolean</span><br><span class="line">    updatable: <span class="literal">false</span></span><br><span class="line">  context:</span><br><span class="line">    description: Customized security context <span class="keyword">for</span> operating servers.</span><br><span class="line">    required: <span class="literal">false</span></span><br><span class="line">    <span class="built_in">type</span>: Map</span><br><span class="line">    updatable: <span class="literal">false</span></span><br><span class="line">  flavor:</span><br><span class="line">    description: ID of flavor used <span class="keyword">for</span> the server.</span><br><span class="line">    required: <span class="literal">true</span></span><br><span class="line">    <span class="built_in">type</span>: String</span><br><span class="line">    updatable: <span class="literal">true</span></span><br><span class="line">  image:</span><br><span class="line">    description: ID of image to be used <span class="keyword">for</span> the new server.</span><br><span class="line">    required: <span class="literal">false</span></span><br><span class="line">    <span class="built_in">type</span>: String</span><br><span class="line">    updatable: <span class="literal">true</span></span><br><span class="line">  key_name:</span><br><span class="line">    description: Name of Nova keypair to be injected to server.</span><br><span class="line">    required: <span class="literal">false</span></span><br><span class="line">    <span class="built_in">type</span>: String</span><br><span class="line">    updatable: <span class="literal">false</span></span><br><span class="line">  metadata:</span><br><span class="line">    description: A collection of key/value pairs to be associated with the server</span><br><span class="line">      created. Both key and value must be &lt;=255 chars.</span><br><span class="line">    required: <span class="literal">false</span></span><br><span class="line">    <span class="built_in">type</span>: Map</span><br><span class="line">    updatable: <span class="literal">true</span></span><br><span class="line">  name:</span><br><span class="line">    description: Name of the server. When omitted, the node name will be used.</span><br><span class="line">    required: <span class="literal">false</span></span><br><span class="line">    <span class="built_in">type</span>: String</span><br><span class="line">    updatable: <span class="literal">true</span></span><br><span class="line">  networks:</span><br><span class="line">    description: List of networks <span class="keyword">for</span> the server.</span><br><span class="line">    required: <span class="literal">false</span></span><br><span class="line">    schema:</span><br><span class="line">      <span class="string">&#x27;*&#x27;</span>:</span><br><span class="line">        description: A map specifying the properties of a network <span class="keyword">for</span> uses.</span><br><span class="line">        required: <span class="literal">false</span></span><br><span class="line">        schema:</span><br><span class="line">          fixed_ip:</span><br><span class="line">            description: Fixed IP to be used by the network.</span><br><span class="line">            required: <span class="literal">false</span></span><br><span class="line">            <span class="built_in">type</span>: String</span><br><span class="line">            updatable: <span class="literal">false</span></span><br><span class="line">          floating_ip:</span><br><span class="line">            description: The floating IP address to be associated with this port.</span><br><span class="line">            required: <span class="literal">false</span></span><br><span class="line">            <span class="built_in">type</span>: String</span><br><span class="line">            updatable: <span class="literal">false</span></span><br><span class="line">          floating_network:</span><br><span class="line">            description: The network on <span class="built_in">which</span> to create a floating IP</span><br><span class="line">            required: <span class="literal">false</span></span><br><span class="line">            <span class="built_in">type</span>: String</span><br><span class="line">            updatable: <span class="literal">false</span></span><br><span class="line">          network:</span><br><span class="line">            description: Name or ID of network to create a port on.</span><br><span class="line">            required: <span class="literal">false</span></span><br><span class="line">            <span class="built_in">type</span>: String</span><br><span class="line">            updatable: <span class="literal">false</span></span><br><span class="line">          port:</span><br><span class="line">            description: Port ID to be used by the network.</span><br><span class="line">            required: <span class="literal">false</span></span><br><span class="line">            <span class="built_in">type</span>: String</span><br><span class="line">            updatable: <span class="literal">false</span></span><br><span class="line">          security_groups:</span><br><span class="line">            description: A list of security <span class="built_in">groups</span> to be attached to this port.</span><br><span class="line">            required: <span class="literal">false</span></span><br><span class="line">            schema:</span><br><span class="line">              <span class="string">&#x27;*&#x27;</span>:</span><br><span class="line">                description: Name of a security group</span><br><span class="line">                required: <span class="literal">true</span></span><br><span class="line">                <span class="built_in">type</span>: String</span><br><span class="line">                updatable: <span class="literal">false</span></span><br><span class="line">            <span class="built_in">type</span>: List</span><br><span class="line">            updatable: <span class="literal">false</span></span><br><span class="line">        <span class="built_in">type</span>: Map</span><br><span class="line">        updatable: <span class="literal">false</span></span><br><span class="line">    <span class="built_in">type</span>: List</span><br><span class="line">    updatable: <span class="literal">true</span></span><br><span class="line">  personality:</span><br><span class="line">    description: List of files to be injected into the server, <span class="built_in">where</span> each.</span><br><span class="line">    required: <span class="literal">false</span></span><br><span class="line">    schema:</span><br><span class="line">      <span class="string">&#x27;*&#x27;</span>:</span><br><span class="line">        description: A map specifying the path &amp; contents <span class="keyword">for</span> an injected file.</span><br><span class="line">        required: <span class="literal">false</span></span><br><span class="line">        schema:</span><br><span class="line">          contents:</span><br><span class="line">            description: Contents of the file to be injected.</span><br><span class="line">            required: <span class="literal">true</span></span><br><span class="line">            <span class="built_in">type</span>: String</span><br><span class="line">            updatable: <span class="literal">false</span></span><br><span class="line">          path:</span><br><span class="line">            description: In-instance path <span class="keyword">for</span> the file to be injected.</span><br><span class="line">            required: <span class="literal">true</span></span><br><span class="line">            <span class="built_in">type</span>: String</span><br><span class="line">            updatable: <span class="literal">false</span></span><br><span class="line">        <span class="built_in">type</span>: Map</span><br><span class="line">        updatable: <span class="literal">false</span></span><br><span class="line">    <span class="built_in">type</span>: List</span><br><span class="line">    updatable: <span class="literal">false</span></span><br><span class="line">  scheduler_hints:</span><br><span class="line">    description: A collection of key/value pairs to be associated with the Scheduler</span><br><span class="line">      hints. Both key and value must be &lt;=255 chars.</span><br><span class="line">    required: <span class="literal">false</span></span><br><span class="line">    <span class="built_in">type</span>: Map</span><br><span class="line">    updatable: <span class="literal">false</span></span><br><span class="line">  security_groups:</span><br><span class="line">    description: List of security <span class="built_in">groups</span>.</span><br><span class="line">    required: <span class="literal">false</span></span><br><span class="line">    schema:</span><br><span class="line">      <span class="string">&#x27;*&#x27;</span>:</span><br><span class="line">        description: Name of a security group</span><br><span class="line">        required: <span class="literal">true</span></span><br><span class="line">        <span class="built_in">type</span>: String</span><br><span class="line">        updatable: <span class="literal">false</span></span><br><span class="line">    <span class="built_in">type</span>: List</span><br><span class="line">    updatable: <span class="literal">false</span></span><br><span class="line">  user_data:</span><br><span class="line">    description: User data to be exposed by the metadata server.</span><br><span class="line">    required: <span class="literal">false</span></span><br><span class="line">    <span class="built_in">type</span>: String</span><br><span class="line">    updatable: <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<p>container.dockerinc.docker</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster profile <span class="built_in">type</span> show container.dockerinc.docker-1.0</span><br><span class="line">support_status:</span><br><span class="line">  <span class="string">&#x27;1.0&#x27;</span>:</span><br><span class="line">  - since: <span class="string">&#x27;2017.02&#x27;</span></span><br><span class="line">    status: EXPERIMENTAL</span><br><span class="line"><span class="built_in">id</span>: container.dockerinc.docker-1.0</span><br><span class="line">location:</span><br><span class="line">  cloud: <span class="string">&#x27;&#x27;</span></span><br><span class="line">  project:</span><br><span class="line">    domain_id: null</span><br><span class="line">    domain_name: Default</span><br><span class="line">    <span class="built_in">id</span>: f52380b8eb5345f0a568a186a5a832a5</span><br><span class="line">    name: admin</span><br><span class="line">  region_name: RegionOne</span><br><span class="line">  zone: null</span><br><span class="line">name: container.dockerinc.docker-1.0</span><br><span class="line">schema:</span><br><span class="line">  <span class="built_in">command</span>:</span><br><span class="line">    description: The <span class="built_in">command</span> to run when container is started.</span><br><span class="line">    required: <span class="literal">false</span></span><br><span class="line">    <span class="built_in">type</span>: String</span><br><span class="line">    updatable: <span class="literal">false</span></span><br><span class="line">  context:</span><br><span class="line">    description: Customized security context <span class="keyword">for</span> operating containers.</span><br><span class="line">    required: <span class="literal">false</span></span><br><span class="line">    <span class="built_in">type</span>: Map</span><br><span class="line">    updatable: <span class="literal">false</span></span><br><span class="line">  host_cluster:</span><br><span class="line">    description: The cluster on <span class="built_in">which</span> container will be launched.</span><br><span class="line">    required: <span class="literal">false</span></span><br><span class="line">    <span class="built_in">type</span>: String</span><br><span class="line">    updatable: <span class="literal">false</span></span><br><span class="line">  host_node:</span><br><span class="line">    description: The node on <span class="built_in">which</span> container will be launched.</span><br><span class="line">    required: <span class="literal">false</span></span><br><span class="line">    <span class="built_in">type</span>: String</span><br><span class="line">    updatable: <span class="literal">false</span></span><br><span class="line">  image:</span><br><span class="line">    description: The image used to create a container</span><br><span class="line">    required: <span class="literal">true</span></span><br><span class="line">    <span class="built_in">type</span>: String</span><br><span class="line">    updatable: <span class="literal">false</span></span><br><span class="line">  name:</span><br><span class="line">    description: The name of the container.</span><br><span class="line">    required: <span class="literal">false</span></span><br><span class="line">    <span class="built_in">type</span>: String</span><br><span class="line">    updatable: <span class="literal">true</span></span><br><span class="line">  port:</span><br><span class="line">    default: 2375</span><br><span class="line">    description: The port number used to connect to docker daemon.</span><br><span class="line">    required: <span class="literal">false</span></span><br><span class="line">    <span class="built_in">type</span>: Integer</span><br><span class="line">    updatable: <span class="literal">false</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<div class="alert info no-icon"><ul>
<li>default：未明确指定时属性的默认值。</li>
<li>description：属性的文字描述。</li>
<li>required：是否必须指定属性。这种属性通常没有默认值。</li>
<li>type：<strong>String</strong>, <strong>Integer</strong>, <strong>Boolean</strong>, <strong>Map</strong>或者<strong>List</strong>。</li>
<li>updatable：属性是否可更新。</li>
</ul>
</div>

<h5 id="查看Profile-Type操作"><a href="#查看Profile-Type操作" class="headerlink" title="查看Profile Type操作"></a>查看Profile Type操作</h5><p>查看Profile Type支持的操作。</p>
<p>os.heat.stack</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster profile <span class="built_in">type</span> ops os.heat.stack-1.0</span><br><span class="line"></span><br><span class="line">operations:</span><br><span class="line">  abandon:</span><br><span class="line">    description: Abandon a heat stack node.</span><br><span class="line">    required: <span class="literal">false</span></span><br><span class="line">    <span class="built_in">type</span>: Map</span><br><span class="line">    updatable: <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<p>os.nova.server</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster profile <span class="built_in">type</span> ops os.nova.server-1.0                                                 </span><br><span class="line"></span><br><span class="line">operations:</span><br><span class="line">  change_password:</span><br><span class="line">    description: Change the administrator password.</span><br><span class="line">    parameters:</span><br><span class="line">      admin_pass:</span><br><span class="line">        description: New password <span class="keyword">for</span> the administrator.</span><br><span class="line">        required: <span class="literal">false</span></span><br><span class="line">        <span class="built_in">type</span>: String</span><br><span class="line">  evacuate:</span><br><span class="line">    description: Evacuate the server to a different host.</span><br><span class="line">    parameters:</span><br><span class="line">      force:</span><br><span class="line">        description: Whether the evacuation should be a forced one.</span><br><span class="line">        required: <span class="literal">false</span></span><br><span class="line">        <span class="built_in">type</span>: String</span><br><span class="line">      host:</span><br><span class="line">        description: The target host to evacuate the server.</span><br><span class="line">        required: <span class="literal">false</span></span><br><span class="line">        <span class="built_in">type</span>: String</span><br><span class="line">  lock:</span><br><span class="line">    description: Lock the server.</span><br><span class="line">    parameters: &#123;&#125;</span><br><span class="line">  pause:</span><br><span class="line">    description: Pause the server from running.</span><br><span class="line">    parameters: &#123;&#125;</span><br><span class="line">  reboot:</span><br><span class="line">    description: Reboot the nova server.</span><br><span class="line">    parameters:</span><br><span class="line">      <span class="built_in">type</span>:</span><br><span class="line">        constraints:</span><br><span class="line">        - constraint:</span><br><span class="line">          - SOFT</span><br><span class="line">          - HARD</span><br><span class="line">          <span class="built_in">type</span>: AllowedValues</span><br><span class="line">        default: SOFT</span><br><span class="line">        description: Type of reboot <span class="built_in">which</span> can be <span class="string">&#x27;SOFT&#x27;</span> or <span class="string">&#x27;HARD&#x27;</span>.</span><br><span class="line">        required: <span class="literal">false</span></span><br><span class="line">        <span class="built_in">type</span>: String</span><br><span class="line">  rebuild:</span><br><span class="line">    description: Rebuild the server using current image and admin password.</span><br><span class="line">    parameters: &#123;&#125;</span><br><span class="line">  rescue:</span><br><span class="line">    description: Rescue the server.</span><br><span class="line">    parameters:</span><br><span class="line">      image_ref:</span><br><span class="line">        description: A string referencing the image to use.</span><br><span class="line">        required: <span class="literal">false</span></span><br><span class="line">        <span class="built_in">type</span>: String</span><br><span class="line">  resume:</span><br><span class="line">    description: Resume the running of the server.</span><br><span class="line">    parameters: &#123;&#125;</span><br><span class="line">  start:</span><br><span class="line">    description: Start the server.</span><br><span class="line">    parameters: &#123;&#125;</span><br><span class="line">  stop:</span><br><span class="line">    description: Stop the server.</span><br><span class="line">    parameters: &#123;&#125;</span><br><span class="line">  <span class="built_in">suspend</span>:</span><br><span class="line">    description: Suspend the running of the server.</span><br><span class="line">    parameters: &#123;&#125;</span><br><span class="line">  unlock:</span><br><span class="line">    description: Unlock the server.</span><br><span class="line">    parameters: &#123;&#125;</span><br><span class="line">  unpause:</span><br><span class="line">    description: Unpause the server to running state.</span><br><span class="line">    parameters: &#123;&#125;</span><br><span class="line">  unrescue:</span><br><span class="line">    description: Unrescue the server.</span><br><span class="line">    parameters: &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>container.dockerinc.docker</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster profile <span class="built_in">type</span> ops container.dockerinc.docker-1.0                                     </span><br><span class="line"></span><br><span class="line">operations:</span><br><span class="line">  pause:</span><br><span class="line">    description: Pause a container.</span><br><span class="line">    parameters: &#123;&#125;</span><br><span class="line">  restart:</span><br><span class="line">    description: Restart a container.</span><br><span class="line">    parameters:</span><br><span class="line">      wait_time:</span><br><span class="line">        description: Number of seconds to <span class="built_in">wait</span> before killing the container.</span><br><span class="line">        required: <span class="literal">false</span></span><br><span class="line">        <span class="built_in">type</span>: Integer</span><br><span class="line">  unpause:</span><br><span class="line">    description: Unpause a container.</span><br><span class="line">    parameters: &#123;&#125;</span><br></pre></td></tr></table></figure>

<div class="alert info no-icon"><ul>
<li>description：属性的文字描述。</li>
<li>required：是否必须指定属性。这种属性通常没有默认值。</li>
<li>type：<strong>String</strong>, <strong>Integer</strong>, <strong>Boolean</strong>, <strong>Map</strong>或者<strong>List</strong>。</li>
<li>updatable：属性是否可更新。</li>
</ul>
</div>

<h4 id="Profile"><a href="#Profile" class="headerlink" title="Profile"></a>Profile</h4><p>配置文件（<strong>Profile</strong>）是用于创建节点（<strong>Node</strong>）的模型，可以将其视为具有唯一ID的Profile Type的实例。Profile在名为<strong>spec</strong>的属性中编码创建节点所需的信息。</p>
<p>Profile Type实现的主要工作是将用户提供的JSON数据结构转换为驱动程序可以使用的信息。驱动程序将根据提供的信息创建/删除/更新物理对象。</p>
<h5 id="创建Profile"><a href="#创建Profile" class="headerlink" title="创建Profile"></a>创建Profile</h5><p>在使用集群（Cluster）或节点（Node）之前，您将需要使用配置文件类型（Profile Type）创建的配置文件（Profile）对象。要创建配置文件，您将需要YAML格式的<strong>spec</strong>文件。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /examples/profiles/heat_stack/random_string/ heat_stack_random_string.yaml</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">os.heat.stack</span></span><br><span class="line"><span class="attr">version:</span> <span class="number">1.0</span></span><br><span class="line"><span class="attr">properties:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">random_string_stack</span></span><br><span class="line">  <span class="attr">template:</span> <span class="string">random_string_template.yaml</span></span><br><span class="line">  <span class="attr">context:</span></span><br><span class="line">    <span class="attr">region_name:</span> <span class="string">RegionOne</span></span><br></pre></td></tr></table></figure>
<p>random_string_template.yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">heat_template_version:</span> <span class="number">2014-10-16</span></span><br><span class="line"><span class="attr">parameters:</span></span><br><span class="line">  <span class="attr">str_length:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">number</span></span><br><span class="line">    <span class="attr">default:</span> <span class="number">64</span></span><br><span class="line"><span class="attr">resources:</span></span><br><span class="line">  <span class="attr">random:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">OS::Heat::RandomString</span></span><br><span class="line">    <span class="attr">properties:</span></span><br><span class="line">      <span class="attr">length:</span> &#123;<span class="attr">get_param:</span> <span class="string">str_length</span>&#125;</span><br><span class="line"><span class="attr">outputs:</span></span><br><span class="line">  <span class="attr">result:</span></span><br><span class="line">    <span class="attr">value:</span> &#123;<span class="attr">get_attr:</span> [<span class="string">random</span>, <span class="string">value</span>]&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster profile create --spec heat_stack_random_string.yaml my_stack</span><br><span class="line"></span><br><span class="line">+------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Field      | Value                                                                                                                                                                                       |</span><br><span class="line">+------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| created_at | 2019-09-25T08:02:43Z                                                                                                                                                                        |</span><br><span class="line">| domain_id  | None                                                                                                                                                                                        |</span><br><span class="line">| <span class="built_in">id</span>         | ba4295d7-6800-4db4-8fe8-43ea978c91f9                                                                                                                                                        |</span><br><span class="line">| location   | Munch(&#123;<span class="string">&#x27;project&#x27;</span>: Munch(&#123;<span class="string">&#x27;domain_id&#x27;</span>: None, <span class="string">&#x27;id&#x27;</span>: u<span class="string">&#x27;f52380b8eb5345f0a568a186a5a832a5&#x27;</span>, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;domain_name&#x27;</span>: <span class="string">&#x27;Default&#x27;</span>&#125;), <span class="string">&#x27;cloud&#x27;</span>: <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;region_name&#x27;</span>: <span class="string">&#x27;RegionOne&#x27;</span>, <span class="string">&#x27;zone&#x27;</span>: None&#125;) |</span><br><span class="line">| metadata   | &#123;&#125;                                                                                                                                                                                          |</span><br><span class="line">| name       | my_stack                                                                                                                                                                                    |</span><br><span class="line">| project_id | f52380b8eb5345f0a568a186a5a832a5                                                                                                                                                            |</span><br><span class="line">| spec       | +------------+---------------------------------------------+                                                                                                                                |</span><br><span class="line">|            | | property   | value                                       |                                                                                                                                |</span><br><span class="line">|            | +------------+---------------------------------------------+                                                                                                                                |</span><br><span class="line">|            | | properties | &#123;                                           |                                                                                                                                |</span><br><span class="line">|            | |            |   <span class="string">&quot;files&quot;</span>: &#123;&#125;,                              |                                                                                                                                |</span><br><span class="line">|            | |            |   <span class="string">&quot;disable_rollback&quot;</span>: <span class="literal">true</span>,                 |                                                                                                                                |</span><br><span class="line">|            | |            |   <span class="string">&quot;template&quot;</span>: &#123;                             |                                                                                                                                |</span><br><span class="line">|            | |            |     <span class="string">&quot;outputs&quot;</span>: &#123;                            |                                                                                                                                |</span><br><span class="line">|            | |            |       <span class="string">&quot;result&quot;</span>: &#123;                           |                                                                                                                                |</span><br><span class="line">|            | |            |         <span class="string">&quot;value&quot;</span>: &#123;                          |                                                                                                                                |</span><br><span class="line">|            | |            |           <span class="string">&quot;get_attr&quot;</span>: [                     |                                                                                                                                |</span><br><span class="line">|            | |            |             <span class="string">&quot;random&quot;</span>,                       |                                                                                                                                |</span><br><span class="line">|            | |            |             <span class="string">&quot;value&quot;</span>                         |                                                                                                                                |</span><br><span class="line">|            | |            |           ]                                 |                                                                                                                                |</span><br><span class="line">|            | |            |         &#125;                                   |                                                                                                                                |</span><br><span class="line">|            | |            |       &#125;                                     |                                                                                                                                |</span><br><span class="line">|            | |            |     &#125;,                                      |                                                                                                                                |</span><br><span class="line">|            | |            |     <span class="string">&quot;heat_template_version&quot;</span>: <span class="string">&quot;2014-10-16&quot;</span>,  |                                                                                                                                |</span><br><span class="line">|            | |            |     <span class="string">&quot;resources&quot;</span>: &#123;                          |                                                                                                                                |</span><br><span class="line">|            | |            |       <span class="string">&quot;random&quot;</span>: &#123;                           |                                                                                                                                |</span><br><span class="line">|            | |            |         <span class="string">&quot;type&quot;</span>: <span class="string">&quot;OS::Heat::RandomString&quot;</span>,   |                                                                                                                                |</span><br><span class="line">|            | |            |         <span class="string">&quot;properties&quot;</span>: &#123;                     |                                                                                                                                |</span><br><span class="line">|            | |            |           <span class="string">&quot;length&quot;</span>: &#123;                       |                                                                                                                                |</span><br><span class="line">|            | |            |             <span class="string">&quot;get_param&quot;</span>: <span class="string">&quot;str_length&quot;</span>       |                                                                                                                                |</span><br><span class="line">|            | |            |           &#125;                                 |                                                                                                                                |</span><br><span class="line">|            | |            |         &#125;                                   |                                                                                                                                |</span><br><span class="line">|            | |            |       &#125;                                     |                                                                                                                                |</span><br><span class="line">|            | |            |     &#125;,                                      |                                                                                                                                |</span><br><span class="line">|            | |            |     <span class="string">&quot;parameters&quot;</span>: &#123;                         |                                                                                                                                |</span><br><span class="line">|            | |            |       <span class="string">&quot;str_length&quot;</span>: &#123;                       |                                                                                                                                |</span><br><span class="line">|            | |            |         <span class="string">&quot;default&quot;</span>: 64,                      |                                                                                                                                |</span><br><span class="line">|            | |            |         <span class="string">&quot;type&quot;</span>: <span class="string">&quot;number&quot;</span>                    |                                                                                                                                |</span><br><span class="line">|            | |            |       &#125;                                     |                                                                                                                                |</span><br><span class="line">|            | |            |     &#125;                                       |                                                                                                                                |</span><br><span class="line">|            | |            |   &#125;,                                        |                                                                                                                                |</span><br><span class="line">|            | |            |   <span class="string">&quot;parameters&quot;</span>: &#123;&#125;,                         |                                                                                                                                |</span><br><span class="line">|            | |            |   <span class="string">&quot;timeout&quot;</span>: 60,                            |                                                                                                                                |</span><br><span class="line">|            | |            |   <span class="string">&quot;environment&quot;</span>: &#123;&#125;,                        |                                                                                                                                |</span><br><span class="line">|            | |            |   <span class="string">&quot;context&quot;</span>: &#123;                              |                                                                                                                                |</span><br><span class="line">|            | |            |     <span class="string">&quot;region_name&quot;</span>: <span class="string">&quot;RegionOne&quot;</span>              |                                                                                                                                |</span><br><span class="line">|            | |            |   &#125;                                         |                                                                                                                                |</span><br><span class="line">|            | |            | &#125;                                           |                                                                                                                                |</span><br><span class="line">|            | | <span class="built_in">type</span>       | os.heat.stack                               |                                                                                                                                |</span><br><span class="line">|            | | version    | 1.0                                         |                                                                                                                                |</span><br><span class="line">|            | +------------+---------------------------------------------+                                                                                                                                |</span><br><span class="line">| <span class="built_in">type</span>       | os.heat.stack-1.0                                                                                                                                                                           |</span><br><span class="line">| updated_at | None                                                                                                                                                                                        |</span><br><span class="line">| user_id    | c1bb613f1ece4654b488c65fc0f62df8                                                                                                                                                            |</span><br><span class="line">+------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br></pre></td></tr></table></figure>
<p>（可选）可以在创建新配置文件（Profile）时将一些键值对附加到新配置文件（Profile）。此数据称为配置文件的元数据（metadata）。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster profile create \</span><br><span class="line">    --spec heat_stack_random_string.yaml \</span><br><span class="line">    --metadata <span class="string">&quot;author=King;version=1.0&quot;</span> \</span><br><span class="line">    my_stack</span><br><span class="line"></span><br><span class="line">openstack cluster profile create \</span><br><span class="line">    --spec heat_stack_random_string.yaml \</span><br><span class="line">    --metadata author=King --metadata version=1.0 \</span><br><span class="line">    my_stack</span><br></pre></td></tr></table></figure>
<h5 id="查看Profiles"><a href="#查看Profiles" class="headerlink" title="查看Profiles"></a>查看Profiles</h5><p>查看创建的Profile列表。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster profile list</span><br></pre></td></tr></table></figure>
<div class="figure " style="width:;"><a class="fancybox" href="images/profile-list.png" title="" data-caption="" data-fancybox="default"><img class="fig-img" src="images/profile-list.png" alt=""></a></div>

<h5 id="查看详细Profile"><a href="#查看详细Profile" class="headerlink" title="查看详细Profile"></a>查看详细Profile</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster profile show my_stack</span><br></pre></td></tr></table></figure>

<h5 id="更新Profile"><a href="#更新Profile" class="headerlink" title="更新Profile"></a>更新Profile</h5><p>更新Profile的名称。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster profile update --name new_stack my_stack</span><br></pre></td></tr></table></figure>

<p>更新或者创建元数据（metadata）。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster profile update --metadata version=2.2 my_stack</span><br></pre></td></tr></table></figure>
<div class="alert danger no-icon"><p>不允许更改配置文件的<strong>spec</strong>。<br>进行更改的唯一方法是使用profile create子命令来创建新的配置文件。</p>
</div>

<h5 id="删除Profile"><a href="#删除Profile" class="headerlink" title="删除Profile"></a>删除Profile</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster profile delete my_stack</span><br></pre></td></tr></table></figure>

<h4 id="Cluster"><a href="#Cluster" class="headerlink" title="Cluster"></a>Cluster</h4><p>集群（<strong>Cluster</strong>）是一组逻辑对象，每个逻辑对象在Senlin的术语中称为节点（<strong>Node</strong>）。集群可以包含零个或多个节点。集群的profile_id属性，指定在创建/扩展新节点作为集群成员时使用的默认配置文件（<strong>Profile</strong>）。对于集群中的节点来说，拥有不同的配置文件对象是有效的，因为Senlin仅要求集群中的所有节点都具有相同的配置文件类型（<strong>Profile Type</strong>）。</p>
<h5 id="创建Cluster"><a href="#创建Cluster" class="headerlink" title="创建Cluster"></a>创建Cluster</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster create --profile my_stack my_cluster                                                </span><br><span class="line"></span><br><span class="line">+------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Field            | Value                                                                                                                                                                                       |</span><br><span class="line">+------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| config           | &#123;&#125;                                                                                                                                                                                          |</span><br><span class="line">| created_at       | None                                                                                                                                                                                        |</span><br><span class="line">| data             | &#123;&#125;                                                                                                                                                                                          |</span><br><span class="line">| dependents       | &#123;&#125;                                                                                                                                                                                          |</span><br><span class="line">| desired_capacity | 0                                                                                                                                                                                           |</span><br><span class="line">| domain_id        | None                                                                                                                                                                                        |</span><br><span class="line">| <span class="built_in">id</span>               | eb5843d4-18c7-465f-bf65-76693f617f51                                                                                                                                                        |</span><br><span class="line">| init_at          | 2019-09-25T09:20:40Z                                                                                                                                                                        |</span><br><span class="line">| location         | Munch(&#123;<span class="string">&#x27;project&#x27;</span>: Munch(&#123;<span class="string">&#x27;domain_id&#x27;</span>: None, <span class="string">&#x27;id&#x27;</span>: u<span class="string">&#x27;f52380b8eb5345f0a568a186a5a832a5&#x27;</span>, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;domain_name&#x27;</span>: <span class="string">&#x27;Default&#x27;</span>&#125;), <span class="string">&#x27;cloud&#x27;</span>: <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;region_name&#x27;</span>: <span class="string">&#x27;RegionOne&#x27;</span>, <span class="string">&#x27;zone&#x27;</span>: None&#125;) |</span><br><span class="line">| max_size         | -1                                                                                                                                                                                          |</span><br><span class="line">| metadata         | &#123;&#125;                                                                                                                                                                                          |</span><br><span class="line">| min_size         | 0                                                                                                                                                                                           |</span><br><span class="line">| name             | my_cluster                                                                                                                                                                                  |</span><br><span class="line">| node_ids         |                                                                                                                                                                                             |</span><br><span class="line">| profile_id       | ba4295d7-6800-4db4-8fe8-43ea978c91f9                                                                                                                                                        |</span><br><span class="line">| profile_name     | my_stack                                                                                                                                                                                    |</span><br><span class="line">| project_id       | f52380b8eb5345f0a568a186a5a832a5                                                                                                                                                            |</span><br><span class="line">| status           | INIT                                                                                                                                                                                        |</span><br><span class="line">| status_reason    | Initializing                                                                                                                                                                                |</span><br><span class="line">| <span class="built_in">timeout</span>          | 3600                                                                                                                                                                                        |</span><br><span class="line">| updated_at       | None                                                                                                                                                                                        |</span><br><span class="line">| user_id          | c1bb613f1ece4654b488c65fc0f62df8                                                                                                                                                            |</span><br><span class="line">+------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br></pre></td></tr></table></figure>

<p>从输出中，可以看到一个新的集群对象已创建并处于INIT状态。Senlin将验证使用<strong>--profile</strong>选项指定的配置文件是否存在。服务器允许<PROFILE>值是配置文件名称，配置文件ID或配置文件对象的短ID。</p>
<h6 id="集群容量"><a href="#集群容量" class="headerlink" title="集群容量"></a>集群容量</h6><p>创建集群时，默认情况下senlin将创建一个没有节点的集群，即<strong>desired_capacity</strong>将设置为0。但是，可以指定集群的所需容量，集群的最大和最小。<strong>min_size</strong>的默认值为0，<strong>max_size</strong>的默认值为**-1**，这意味着集群大小没有上限。</p>
<p>创建一个集群，其所需容量设置为2，最小大小设置为1，最大大小设置为3。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster create --desired-capacity 2 \</span><br><span class="line">    --min-size 1 --max-size 3 \</span><br><span class="line">    --profile my_stack \</span><br><span class="line">    my_cluster</span><br></pre></td></tr></table></figure>
<div class="alert info no-icon"><p>当未指定<strong>desired_capacity</strong>并且未指定<strong>min_size</strong>时，senlin-engine将创建一个空集群。<br>当指定了<strong>required_capacity</strong>集群容量或<strong>min_size</strong>时，Senlin将在创建集群对象后立即开始创建节点的过程。</p>
</div>

<h6 id="其他属性"><a href="#其他属性" class="headerlink" title="其他属性"></a>其他属性</h6><p>可以使用<strong>--metadata</strong>（或-M）选项将某些键值对与要创建的集群相关联。这些数据称为集群的元数据（<strong>metadata</strong>）。</p>
<p>由于集群操作在执行时可能需要一些时间才能完成，并且Senlin与后端服务进行交互才能实现，因此需要一种方法来验证操作是否超时。创建集群时，可以使用<strong>--timeout</strong>选项，以秒为单位指定默认超时时间。该值将是集群的全局设置。</p>
<p>可以使用选项<strong>--config</strong>将键值对传递给要创建的集群。支持以下配置属性：</p>
<ul>
<li>node.name.format：指定如何自动命名集群节点。该值可以包含占位符，例如**$nI<strong>用于在节点索引的左边填充n个零，或</strong>$nR**用于长度为n的随机字符串。</li>
<li>cluster.stop_node_before_delete：如果设置为True，则导致节点删除的集群操作（调整大小等）将首先请求节点停止。成功关闭节点后，将删除该节点。默认设置为False，集群将在不停止该节点的情况下执行节点删除。</li>
</ul>
<h5 id="查看Clusters"><a href="#查看Clusters" class="headerlink" title="查看Clusters"></a>查看Clusters</h5><p>查看创建的集群列表。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster list</span><br></pre></td></tr></table></figure>
<div class="figure " style="width:;"><a class="fancybox" href="images/cluster-list.png" title="" data-caption="" data-fancybox="default"><img class="fig-img" src="images/cluster-list.png" alt=""></a></div>

<h5 id="查看详细Cluster"><a href="#查看详细Cluster" class="headerlink" title="查看详细Cluster"></a>查看详细Cluster</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster show my_cluster</span><br><span class="line"></span><br><span class="line">+------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Field            | Value                                                                                                                                                                                       |</span><br><span class="line">+------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| config           | &#123;&#125;                                                                                                                                                                                          |</span><br><span class="line">| created_at       | 2019-09-25T09:20:40Z                                                                                                                                                                        |</span><br><span class="line">| data             | &#123;&#125;                                                                                                                                                                                          |</span><br><span class="line">| dependents       | &#123;&#125;                                                                                                                                                                                          |</span><br><span class="line">| desired_capacity | 0                                                                                                                                                                                           |</span><br><span class="line">| domain_id        | None                                                                                                                                                                                        |</span><br><span class="line">| <span class="built_in">id</span>               | eb5843d4-18c7-465f-bf65-76693f617f51                                                                                                                                                        |</span><br><span class="line">| init_at          | 2019-09-25T09:20:40Z                                                                                                                                                                        |</span><br><span class="line">| location         | Munch(&#123;<span class="string">&#x27;project&#x27;</span>: Munch(&#123;<span class="string">&#x27;domain_id&#x27;</span>: None, <span class="string">&#x27;id&#x27;</span>: u<span class="string">&#x27;f52380b8eb5345f0a568a186a5a832a5&#x27;</span>, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;domain_name&#x27;</span>: <span class="string">&#x27;Default&#x27;</span>&#125;), <span class="string">&#x27;cloud&#x27;</span>: <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;region_name&#x27;</span>: <span class="string">&#x27;RegionOne&#x27;</span>, <span class="string">&#x27;zone&#x27;</span>: None&#125;) |</span><br><span class="line">| max_size         | -1                                                                                                                                                                                          |</span><br><span class="line">| metadata         | &#123;&#125;                                                                                                                                                                                          |</span><br><span class="line">| min_size         | 0                                                                                                                                                                                           |</span><br><span class="line">| name             | my_cluster                                                                                                                                                                                  |</span><br><span class="line">| node_ids         |                                                                                                                                                                                             |</span><br><span class="line">| profile_id       | ba4295d7-6800-4db4-8fe8-43ea978c91f9                                                                                                                                                        |</span><br><span class="line">| profile_name     | my_stack                                                                                                                                                                                    |</span><br><span class="line">| project_id       | f52380b8eb5345f0a568a186a5a832a5                                                                                                                                                            |</span><br><span class="line">| status           | ACTIVE                                                                                                                                                                                      |</span><br><span class="line">| status_reason    | CLUSTER_CREATE: number of active nodes is equal or above desired_capacity (0).                                                                                                              |</span><br><span class="line">| <span class="built_in">timeout</span>          | 3600                                                                                                                                                                                        |</span><br><span class="line">| updated_at       | 2019-09-25T09:20:40Z                                                                                                                                                                        |</span><br><span class="line">| user_id          | c1bb613f1ece4654b488c65fc0f62df8                                                                                                                                                            |</span><br><span class="line">+------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>从结果中，可以检查属于该集群的节点的列表。</p>
<h5 id="更新Cluster"><a href="#更新Cluster" class="headerlink" title="更新Cluster"></a>更新Cluster</h5><p>修改集群的名称。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster update --name test_cluster my_cluster</span><br></pre></td></tr></table></figure>
<p>使用选项<strong>--timeout</strong>更改timeout属性。您可以使用选项<strong>--metadata</strong>更改与集群关联的元数据。</p>
<p>更改集群及其成员节点使用的配置文件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster update --profile fedora21_server web_cluster</span><br></pre></td></tr></table></figure>
<div class="alert info no-icon"><p>假设集群web_cluster现在使用的是os.nova.server类型的配置文件，其中使用了Fedora 20的镜像，则上述命令将启动全局升级到使用Fedora 21的镜像的新配置文件。</p>
</div>

<h5 id="调整Cluster大小"><a href="#调整Cluster大小" class="headerlink" title="调整Cluster大小"></a>调整Cluster大小</h5><h6 id="capacity"><a href="#capacity" class="headerlink" title="capacity"></a>capacity</h6><p><strong>--capacity</strong>，将集群调整为指定的大小。<br>将集群test_cluster的大小调整为2个节点，前提是min_size不大于2，并且max_size不小于2或等于-1（指示集群大小没有上限）。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster resize --capacity 2 my_cluster</span><br></pre></td></tr></table></figure>

<h6 id="adjustment"><a href="#adjustment" class="headerlink" title="adjustment"></a>adjustment</h6><p><strong>--adjustment</strong>，向集群添加指定数量的节点，或者从集群中删除指定数量的节点。（正数表示增加，负数表示删除）<br>将两个节点添加到指定的集群：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster resize --adjustment 2 my_cluster</span><br></pre></td></tr></table></figure>
<p>从指定的集群中删除2个节点：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster resize --adjustment 2 my_cluster</span><br></pre></td></tr></table></figure>

<h6 id="percentage"><a href="#percentage" class="headerlink" title="percentage"></a>percentage</h6><p><strong>--percentage</strong>，以指定百分比调整集群的大小。（正数表示扩大，负数表示缩小）</p>
<p>senlin-engine会根据集群的当前大小，指定的百分比值，约束条件（即<strong>min_size</strong>和<strong>max_size</strong>属性）计算要添加或删除的实际节点数。</p>
<p>将集群大小增加30％：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster resize --percentage 30 my_cluster</span><br></pre></td></tr></table></figure>
<p>将集群大小减少25％：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster resize --percentage 25 my_cluster</span><br></pre></td></tr></table></figure>
<h6 id="min-step"><a href="#min-step" class="headerlink" title="min-step"></a>min-step</h6><p>如果因某些限制而无法完全实现调整大小操作，则可以请求根据最大努力进行大小更改，**-–min-step**告诉senlin-engine是否仍然希望部分实现调整大小操作。</p>
<h6 id="strict"><a href="#strict" class="headerlink" title="strict"></a>strict</h6><p>如果指定了<strong>--strict</strong>选项，Senlin将严格遵守集群大小限制。如果容量值超出范围，则该请求将被拒绝。当<strong>--strict</strong>设置为<strong>False</strong>时（默认为False），senlin-engine将尽力调整大小。</p>
<p>假设有一个集群A，其<strong>min_size</strong>设置为5，当前大小为7。如果新的容量值为4，选项<strong>--strict</strong>设置为<strong>True</strong>，则该请求将被拒绝，并显示一条错误消息。如果新的容量值为4，并且未设置选项<strong>--strict</strong>，Senlin将尝试将群集的大小调整为5个节点。</p>
<div class="alert info no-icon"><p>调整大小时，可以同时调整集群的<strong>min_size</strong>和<strong>max_size</strong>属性。</p>
</div>

<div class="alert info no-icon"><p>在计算集群的新容量时，senlin-engine将根据以下规则确定值：</p>
<ul>
<li>如果新容量的值大于1.0或小于-1.0，则将四舍五入为值的整数部分。例如，将3.4舍入为3，-1.9将舍入为-1；</li>
<li>如果新容量的值在0到1之间，Senlin会将其向上舍入为1。</li>
<li>如果新容量的值在0到-1之间，Senlin会将其舍入到-1；</li>
<li>除非指定了<strong>--strict</strong>选项，否则新容量应在<strong>min_size</strong>和<strong>max_size</strong>范围内（包括两端）。</li>
<li>如果未给出<strong>min_size</strong>和<strong>max_size</strong>的新值，则将根据当前大小约束执行范围检查，否则，Senlin将首先验证新大小约束并针对新约束执行范围检查；</li>
<li>如果指定了选项<strong>--min-step</strong>，则当新容量值的绝对值小于&lt;**MIN_STEP**&gt;时，将使用&lt;**MIN_STEP**&gt;值。</li>
</ul>
</div>

<h5 id="Cluster伸缩"><a href="#Cluster伸缩" class="headerlink" title="Cluster伸缩"></a>Cluster伸缩</h5><p>向集群添加两个节点：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster <span class="built_in">expand</span> --count 2 my_cluster</span><br></pre></td></tr></table></figure>
<p>从集群中删除两个节点：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster shrink --count 2 my_cluster</span><br></pre></td></tr></table></figure>
<div class="alert info no-icon"><p>参数&lt;COUNT&gt;，是一个正整数，表示要添加或删除的节点数。<br>选项--count是可选的。如果指定此选项，即使有附加的扩展策略，Senlin仍将使用它来更改群集大小。但是，如果忽略此选项，Senlin会将其视为隐式设置为值1。</p>
</div>

<h5 id="检查Cluster"><a href="#检查Cluster" class="headerlink" title="检查Cluster"></a>检查Cluster</h5><p>属于指定集群的所有节点将执行检查操作。如果节点的物理资源不是<strong>ACTIVE</strong>，则节点状态将作为检查操作的一部分进行更改。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster check my_cluster</span><br></pre></td></tr></table></figure>
<div class="figure " style="width:;"><a class="fancybox" href="images/cluster-check.png" title="" data-caption="" data-fancybox="default"><img class="fig-img" src="images/cluster-check.png" alt=""></a></div>

<h5 id="恢复Cluster"><a href="#恢复Cluster" class="headerlink" title="恢复Cluster"></a>恢复Cluster</h5><p>恢复集群。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster recover my_cluster --check <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<div class="alert info no-icon"><p>选项<strong>--check</strong>是可选的。如果设置此选项，群集将在执行恢复之前执行检查操作。<br>还原操作将从指定的群集中删除节点并重新创建它。</p>
</div>

<h5 id="删除Cluster"><a href="#删除Cluster" class="headerlink" title="删除Cluster"></a>删除Cluster</h5><p>删除集群。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster delete my_cluster</span><br></pre></td></tr></table></figure>
<div class="alert info no-icon"><p>当集群中有节点时，senlin-engine将启动一个进程，以从集群中删除所有节点并销毁它们，然后再删除集群对象本身。</p>
</div>


<h4 id="Node"><a href="#Node" class="headerlink" title="Node"></a>Node</h4><p>节点（<strong>Node</strong>）是由Senlin服务管理的逻辑对象。一个节点在任何时候最多只能是一个集群的成员。一个节点可以是孤立节点，这意味着它不属于任何群集。</p>
<h5 id="创建Node"><a href="#创建Node" class="headerlink" title="创建Node"></a>创建Node</h5><p>创建节点时，该节点具有profile_id属性，该属性指定在创建支持该节点的物理对象时要使用哪个Profile。所以在创建节点时，需要指定要使用的Profile的ID或名称。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster node create --profile my_stack my_node</span><br><span class="line"></span><br><span class="line">+---------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Field         | Value                                                                                                                                                                                       |</span><br><span class="line">+---------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| cluster_id    |                                                                                                                                                                                             |</span><br><span class="line">| created_at    | None                                                                                                                                                                                        |</span><br><span class="line">| data          | &#123;&#125;                                                                                                                                                                                          |</span><br><span class="line">| dependents    | &#123;&#125;                                                                                                                                                                                          |</span><br><span class="line">| details       | None                                                                                                                                                                                        |</span><br><span class="line">| domain_id     | None                                                                                                                                                                                        |</span><br><span class="line">| <span class="built_in">id</span>            | 21b3e7dd-9f7f-4dea-93a0-9d03eb7b1236                                                                                                                                                        |</span><br><span class="line">| index         | -1                                                                                                                                                                                          |</span><br><span class="line">| init_at       | 2019-09-26T03:58:12Z                                                                                                                                                                        |</span><br><span class="line">| location      | Munch(&#123;<span class="string">&#x27;project&#x27;</span>: Munch(&#123;<span class="string">&#x27;domain_id&#x27;</span>: None, <span class="string">&#x27;id&#x27;</span>: u<span class="string">&#x27;f52380b8eb5345f0a568a186a5a832a5&#x27;</span>, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;domain_name&#x27;</span>: <span class="string">&#x27;Default&#x27;</span>&#125;), <span class="string">&#x27;cloud&#x27;</span>: <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;region_name&#x27;</span>: <span class="string">&#x27;RegionOne&#x27;</span>, <span class="string">&#x27;zone&#x27;</span>: None&#125;) |</span><br><span class="line">| metadata      | &#123;&#125;                                                                                                                                                                                          |</span><br><span class="line">| name          | my_node                                                                                                                                                                                     |</span><br><span class="line">| physical_id   | None                                                                                                                                                                                        |</span><br><span class="line">| profile_id    | ba4295d7-6800-4db4-8fe8-43ea978c91f9                                                                                                                                                        |</span><br><span class="line">| profile_name  | my_stack                                                                                                                                                                                    |</span><br><span class="line">| project_id    | f52380b8eb5345f0a568a186a5a832a5                                                                                                                                                            |</span><br><span class="line">| role          |                                                                                                                                                                                             |</span><br><span class="line">| status        | INIT                                                                                                                                                                                        |</span><br><span class="line">| status_reason | Initializing                                                                                                                                                                                |</span><br><span class="line">| updated_at    | None                                                                                                                                                                                        |</span><br><span class="line">| user_id       | c1bb613f1ece4654b488c65fc0f62df8                                                                                                                                                            |</span><br><span class="line">+---------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br></pre></td></tr></table></figure>
<div class="alert danger no-icon"><p>新节点的索引属性为-1。这是因为为节点指定所属集群。<br>可以使用命令openstack cluster member add在节点创建后，为集群<a href="">添加成员</a>。<br>当节点成为集群的成员时，它将为其索引属性获取一个值，该值可在所属集群中唯一标识其自身。</p>
</div>

<p>在创建节点时指定拥有的集群：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster node create --profile my_stack --cluster my_cluster my_node</span><br></pre></td></tr></table></figure>
<div class="alert warning no-icon"><p>当指定拥有的群集时，senlin-engine将验证指定的群集Profile Type与新节点的Profile Type是否相同。如果配置文件类型不匹配，将会收到一个错误信息。</p>
</div>

<p>创建新节点时，可能会用到的另一个参数是<strong>--role</strong>选项。<br>创建一个主节点：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster node create --profile my_stack --cluster my_cluster --role master master_node</span><br></pre></td></tr></table></figure>
<p>创建新节点时，可以指定的最后一个参数是<strong>--metadata</strong>选项。此选项的值是由分号（’;’）分隔的键值对的列表。这些键值对附加到节点，并且可以用于任何目的。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster node create --profile my_stack --metadata owner=King my_node</span><br></pre></td></tr></table></figure>

<h5 id="查看Nodes"><a href="#查看Nodes" class="headerlink" title="查看Nodes"></a>查看Nodes</h5><p>查看节点列表。</p>
<div class="figure " style="width:;"><a class="fancybox" href="images/node-list.png" title="" data-caption="" data-fancybox="default"><img class="fig-img" src="images/node-list.png" alt=""></a></div>

<h5 id="查看详细Node"><a href="#查看详细Node" class="headerlink" title="查看详细Node"></a>查看详细Node</h5><p>查看节点详细信息。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster node show node-TDqkLXqv                                                            </span><br><span class="line"></span><br><span class="line">+---------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Field         | Value                                                                                                                                                                                       |</span><br><span class="line">+---------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| cluster_id    | eb5843d4-18c7-465f-bf65-76693f617f51                                                                                                                                                        |</span><br><span class="line">| created_at    | 2019-09-26T06:19:55Z                                                                                                                                                                        |</span><br><span class="line">| data          | &#123;&#125;                                                                                                                                                                                          |</span><br><span class="line">| dependents    | &#123;&#125;                                                                                                                                                                                          |</span><br><span class="line">| details       | None                                                                                                                                                                                        |</span><br><span class="line">| domain_id     | None                                                                                                                                                                                        |</span><br><span class="line">| <span class="built_in">id</span>            | 2549b4ad-d29d-4a67-8bf3-c803538241d5                                                                                                                                                        |</span><br><span class="line">| index         | 4                                                                                                                                                                                           |</span><br><span class="line">| init_at       | 2019-09-26T06:19:49Z                                                                                                                                                                        |</span><br><span class="line">| location      | Munch(&#123;<span class="string">&#x27;project&#x27;</span>: Munch(&#123;<span class="string">&#x27;domain_id&#x27;</span>: None, <span class="string">&#x27;id&#x27;</span>: u<span class="string">&#x27;f52380b8eb5345f0a568a186a5a832a5&#x27;</span>, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;domain_name&#x27;</span>: <span class="string">&#x27;Default&#x27;</span>&#125;), <span class="string">&#x27;cloud&#x27;</span>: <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;region_name&#x27;</span>: <span class="string">&#x27;RegionOne&#x27;</span>, <span class="string">&#x27;zone&#x27;</span>: None&#125;) |</span><br><span class="line">| metadata      | &#123;&#125;                                                                                                                                                                                          |</span><br><span class="line">| name          | node-TDqkLXqv                                                                                                                                                                               |</span><br><span class="line">| physical_id   | 7ceed7f7-84d3-44da-a767-95651602c5a3                                                                                                                                                        |</span><br><span class="line">| profile_id    | ba4295d7-6800-4db4-8fe8-43ea978c91f9                                                                                                                                                        |</span><br><span class="line">| profile_name  | my_stack                                                                                                                                                                                    |</span><br><span class="line">| project_id    | f52380b8eb5345f0a568a186a5a832a5                                                                                                                                                            |</span><br><span class="line">| role          | master                                                                                                                                                                                      |</span><br><span class="line">| status        | ACTIVE                                                                                                                                                                                      |</span><br><span class="line">| status_reason | Creation succeeded                                                                                                                                                                          |</span><br><span class="line">| updated_at    | 2019-09-26T06:19:55Z                                                                                                                                                                        |</span><br><span class="line">| user_id       | c1bb613f1ece4654b488c65fc0f62df8                                                                                                                                                            |</span><br><span class="line">+---------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line"></span><br><span class="line">+---------------+------------------------------------------------+</span><br><span class="line">| Field         | Value                                          |</span><br><span class="line">+---------------+------------------------------------------------+</span><br><span class="line">| cluster_id    |                                                |</span><br><span class="line">| created_at    | None                                           |</span><br><span class="line">| data          | &#123;&#125;                                             |</span><br><span class="line">| dependents    | &#123;&#125;                                             |</span><br><span class="line">| details       | None                                           |</span><br><span class="line">| domain_id     | None                                           |</span><br><span class="line">| <span class="built_in">id</span>            | 21b3e7dd-9f7f-4dea-93a0-9d03eb7b1236           |</span><br><span class="line">| index         | -1                                             |</span><br><span class="line">| init_at       | 2019-09-26T03:58:12Z                           |</span><br><span class="line">| location      | None                                           |</span><br><span class="line">| metadata      | &#123;&#125;                                             |</span><br><span class="line">| name          | my_node                                        |</span><br><span class="line">| physical_id   | None                                           |</span><br><span class="line">| profile_id    | ba4295d7-6800-4db4-8fe8-43ea978c91f9           |</span><br><span class="line">| profile_name  | my_stack                                       |</span><br><span class="line">| project_id    | f52380b8eb5345f0a568a186a5a832a5               |</span><br><span class="line">| role          |                                                |</span><br><span class="line">| status        | INIT                                           |</span><br><span class="line">| status_reason | Initializing                                   |</span><br><span class="line">| updated_at    | None                                           |</span><br><span class="line">| user_id       | c1bb613f1ece4654b488c65fc0f62df8               |</span><br><span class="line">+---------------+------------------------------------------------+</span><br></pre></td></tr></table></figure>
<div class="alert info no-icon"><p>从输出中，可以看到节点的physical_id（如果已成功创建）。对于不同的配置文件类型，此值可以是某种类型的对象的ID。例如，如果使用的配置文件类型为os.heat.stack，则表示Heat Stack ID；如果使用的配置文件类型是os.nova.server，则将给出Nova虚机ID。</p>
</div>

<p>选项<strong>--details</strong>指定后，将得到有关支持该节点的物理对象的详细信息。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster node show --details node-TDqkLXqv</span><br></pre></td></tr></table></figure>

<h5 id="检查Node"><a href="#检查Node" class="headerlink" title="检查Node"></a>检查Node</h5><p>senlin-engine执行特定于配置文件的检查操作，以获取物理资源（例如虚拟机）的最新状态。如果虚拟机状态不是ACTIVE，则该节点将设置为ERROR状态。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster node check my_node</span><br></pre></td></tr></table></figure>

<h5 id="恢复Node"><a href="#恢复Node" class="headerlink" title="恢复Node"></a>恢复Node</h5><p>创建节点并运行一段时间后，如果该节点进入ERROR状态，则可以使用命令尝试将其恢复为ACTIVE状态。恢复操作将删除指定的节点并重新创建它。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster node recover my_node</span><br></pre></td></tr></table></figure>

<h5 id="更新Node"><a href="#更新Node" class="headerlink" title="更新Node"></a>更新Node</h5><p>更新节点名称。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster node update --name new_node_name old_node_name</span><br></pre></td></tr></table></figure>

<p>更改节点角色。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster node update --role slave master_node</span><br></pre></td></tr></table></figure>

<p>更新元数据。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster node update --metadata version=2.1 my_node</span><br></pre></td></tr></table></figure>

<p>更改节点的Profile。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster node update --profile fedora21_server fedora20_server</span><br></pre></td></tr></table></figure>
<div class="alert info no-icon"><p>假设节点fedora20_server现在使用的是os.nova.server类型的配置文件，其中使用了Fedora 20镜像，经过上述命令，该节点将使用新的配置文件和Fedora 21镜像。</p>
</div>

<h5 id="生成Node"><a href="#生成Node" class="headerlink" title="生成Node"></a>生成Node</h5><p>在Senlin服务中，我们可以采用现有资源作为节点，并为此节点创建配置文件。要生成节点，您需要通过设置<strong>--identity</strong>来指定物理资源ID和设置–type来指定配置文件类型（Profile Type）。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster node adopt </span><br><span class="line">    --identity 1177c8e8-8472-4e9d-8f15-1d4866b85b8b \</span><br><span class="line">    --<span class="built_in">type</span> os.nova.server-1.0 \</span><br><span class="line">    --name test_adopt_node</span><br></pre></td></tr></table></figure>
<div class="alert info no-icon"><p><strong>--name</strong>是可选的，如果省略，senlin-engine将为该节点生成一个以node-开头的随机名称。<br><strong>--role</strong>和<strong>--metadata</strong>和创建节点时使用一致。</p>
</div>

<p><strong>--overrides</strong>支持用户可以覆盖节点的配置文件（Profile）的属性。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster node adopt </span><br><span class="line">    --identity 1177c8e8-8472-4e9d-8f15-1d4866b85b8b \</span><br><span class="line">    --<span class="built_in">type</span> os.nova.server-1.0 \</span><br><span class="line">    --override <span class="string">&#x27;&#123;&quot;networks&quot;:[&#123;&quot;network&quot;: &quot;public&quot;&#125;]&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>--snapshot</strong>选项是布尔类型。如果设置，senlin-engine将在接受资源作为节点之前为资源创建快照。</p>
<p>预览要生成的节点。要预览节点，您需要通过设置<strong>--identity</strong>来指定资源物理ID，并通过设置<strong>--type</strong>来指定资源Profile Type名称。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster node adopt </span><br><span class="line">    --identity 1177c8e8-8472-4e9d-8f15-1d4866b85b8b \</span><br><span class="line">    --<span class="built_in">type</span> os.nova.server-1.0 \</span><br><span class="line">    --preview</span><br></pre></td></tr></table></figure>

<h5 id="删除Node"><a href="#删除Node" class="headerlink" title="删除Node"></a>删除Node</h5><p>删除节点。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster node delete my_node</span><br></pre></td></tr></table></figure>

<h4 id="Cluster-Membership"><a href="#Cluster-Membership" class="headerlink" title="Cluster Membership"></a>Cluster Membership</h4><p>一个节点在任何时候最多可以属于一个集群。一个节点不属于任何群集时，称为孤立节点。创建节点时，可以使其成为集群的成员，也可以在创建集群和节点之后更改集群成员资格。</p>
<h5 id="查看Cluster成员"><a href="#查看Cluster成员" class="headerlink" title="查看Cluster成员"></a>查看Cluster成员</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster members list my_cluster</span><br></pre></td></tr></table></figure>
<div class="figure " style="width:;"><a class="fancybox" href="images/members-list.png" title="" data-caption="" data-fancybox="default"><img class="fig-img" src="images/members-list.png" alt=""></a></div>

<h5 id="增加Cluster成员"><a href="#增加Cluster成员" class="headerlink" title="增加Cluster成员"></a>增加Cluster成员</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster members add --nodes node3,node4 my_cluster</span><br></pre></td></tr></table></figure>

<h5 id="移除Cluster成员"><a href="#移除Cluster成员" class="headerlink" title="移除Cluster成员"></a>移除Cluster成员</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster members del --nodes node21,node22 my_cluster</span><br></pre></td></tr></table></figure>
<div class="alert info no-icon"><p>从集群中删除节点后，它们的索引属性将重置为-1。</p>
</div>

<h5 id="替换Cluster成员"><a href="#替换Cluster成员" class="headerlink" title="替换Cluster成员"></a>替换Cluster成员</h5><p>用node22替换node21。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster members replace --nodes node21=node22 my_cluster</span><br></pre></td></tr></table></figure>
<div class="alert warning no-icon"><p>执行此操作时，senlin-engine将检查替换的节点是否是指定集群的成员。如果指定节点列表中的任何节点都不属于目标群集，则将收到错误消息，命令将失败。</p>
</div>

<h4 id="Policy-Type"><a href="#Policy-Type" class="headerlink" title="Policy Type"></a>Policy Type</h4><p>策略类型（Policy Type）是在包含特定配置文件类型（Profile Type）的节点的集群上，执行特定操作时要检查和执行的规则的规范。</p>
<p>启动senlin-engine时，策略类型的注册表会建立在内存中。未来，Senlin将允许用户提供其他策略类型的实现，作为可动态加载的插件。</p>
<p>策略类型的实现指明哪些字段是必需的，哪些字段是可选的，有时还会限制字段值。通过引用此策略类型创建策略时，将为这些字段分配具体值。例如，策略类型senlin.policy.deletion所需的属性：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">criteria:</span> <span class="string">String</span> <span class="comment"># valid values - OLDEST_FIRST, YOUNGEST_FIRST, RANDOM</span></span><br><span class="line"><span class="attr">destroy_after_deletion:</span> <span class="string">Boolean</span></span><br><span class="line"><span class="attr">grace_period:</span> <span class="string">Integer</span></span><br><span class="line"><span class="attr">reduce_desired_capacity:</span> <span class="string">Boolean</span></span><br></pre></td></tr></table></figure>

<p>此策略类型的策略对象的规范可能如下所示：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">type:</span> <span class="string">senlin.policy.deletion</span></span><br><span class="line"><span class="attr">version:</span> <span class="number">1.0</span></span><br><span class="line"><span class="attr">properties:</span></span><br><span class="line">  <span class="attr">criteria:</span> <span class="string">OLDEST_FIRST</span></span><br><span class="line">  <span class="attr">destroy_after_deletion:</span> <span class="literal">True</span></span><br><span class="line">  <span class="attr">grace_period:</span> <span class="number">120</span></span><br><span class="line">  <span class="attr">reduce_desired_capacity:</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<h5 id="查看Policy-Types"><a href="#查看Policy-Types" class="headerlink" title="查看Policy Types"></a>查看Policy Types</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster policy <span class="built_in">type</span> list</span><br></pre></td></tr></table></figure>
<div class="figure " style="width:;"><a class="fancybox" href="images/policy-type-list.png" title="" data-caption="" data-fancybox="default"><img class="fig-img" src="images/policy-type-list.png" alt=""></a></div>

<h5 id="查看详细Policy-Type"><a href="#查看详细Policy-Type" class="headerlink" title="查看详细Policy Type"></a>查看详细Policy Type</h5><p>查看Policy Type详细信息。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster policy <span class="built_in">type</span> show senlin.policy.health-1.0</span><br></pre></td></tr></table></figure>

<h4 id="Policy"><a href="#Policy" class="headerlink" title="Policy"></a>Policy</h4><p>策略（Policy）是从策略类型（Policy Type）实例化的对象。创建之后，就可以将其动态附加到集群或从集群分离。策略通常包含要执行或已经执行某些动作时要检查和强制实施的规则。</p>
<p>一个策略可以附加到许多集群，而一个集群可以附加许多策略。除此之外，还可以动态启用或禁用集群上的策略。</p>
<h4 id="创建Policy"><a href="#创建Policy" class="headerlink" title="创建Policy"></a>创建Policy</h4><p>创建新的策略对象时，需要YAML格式的<strong>spec</strong>文件。还可能需要查看策略类型（Policy Type）中的属性名称和特定的策略类型。</p>
<p>examples/policies/deletion_policy.yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Sample deletion policy that can be attached to a cluster.</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">senlin.policy.deletion</span></span><br><span class="line"><span class="attr">version:</span> <span class="number">1.0</span></span><br><span class="line"><span class="attr">description:</span> <span class="string">A</span> <span class="string">policy</span> <span class="string">for</span> <span class="string">choosing</span> <span class="string">victim</span> <span class="string">node(s)</span> <span class="string">from</span> <span class="string">a</span> <span class="string">cluster</span> <span class="string">for</span> <span class="string">deletion.</span></span><br><span class="line"><span class="attr">properties:</span></span><br><span class="line">  <span class="comment"># The valid values include:</span></span><br><span class="line">  <span class="comment"># OLDEST_FIRST, OLDEST_PROFILE_FIRST, YOUNGEST_FIRST, RANDOM</span></span><br><span class="line">  <span class="attr">criteria:</span> <span class="string">OLDEST_FIRST</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Whether deleted node should be destroyed </span></span><br><span class="line">  <span class="attr">destroy_after_deletion:</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Length in number of seconds before the actual deletion happens</span></span><br><span class="line">  <span class="comment"># This param buys an instance some time before deletion</span></span><br><span class="line">  <span class="attr">grace_period:</span> <span class="number">60</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Whether the deletion will reduce the desired capacity of</span></span><br><span class="line">  <span class="comment"># the cluster as well</span></span><br><span class="line">  <span class="attr">reduce_desired_capacity:</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>
<p>创建Policy</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster policy create --spec deletion_policy.yaml my_policy</span><br><span class="line"></span><br><span class="line">+------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Field      | Value                                                                                                                                                                                       |</span><br><span class="line">+------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| created_at | 2019-09-27T02:17:12.000000                                                                                                                                                                  |</span><br><span class="line">| data       | &#123;&#125;                                                                                                                                                                                          |</span><br><span class="line">| domain_id  | None                                                                                                                                                                                        |</span><br><span class="line">| <span class="built_in">id</span>         | 53d08309-236e-4e49-87b1-a913077b6c79                                                                                                                                                        |</span><br><span class="line">| location   | Munch(&#123;<span class="string">&#x27;project&#x27;</span>: Munch(&#123;<span class="string">&#x27;domain_id&#x27;</span>: None, <span class="string">&#x27;id&#x27;</span>: u<span class="string">&#x27;f52380b8eb5345f0a568a186a5a832a5&#x27;</span>, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;domain_name&#x27;</span>: <span class="string">&#x27;Default&#x27;</span>&#125;), <span class="string">&#x27;cloud&#x27;</span>: <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;region_name&#x27;</span>: <span class="string">&#x27;RegionOne&#x27;</span>, <span class="string">&#x27;zone&#x27;</span>: None&#125;) |</span><br><span class="line">| name       | delete_policy                                                                                                                                                                               |</span><br><span class="line">| project_id | f52380b8eb5345f0a568a186a5a832a5                                                                                                                                                            |</span><br><span class="line">| spec       | &#123;                                                                                                                                                                                           |</span><br><span class="line">|            |   <span class="string">&quot;version&quot;</span>: 1.0,                                                                                                                                                                           |</span><br><span class="line">|            |   <span class="string">&quot;type&quot;</span>: <span class="string">&quot;senlin.policy.deletion&quot;</span>,                                                                                                                                                         |</span><br><span class="line">|            |   <span class="string">&quot;description&quot;</span>: <span class="string">&quot;A policy for choosing victim node(s) from a cluster for deletion.&quot;</span>,                                                                                                       |</span><br><span class="line">|            |   <span class="string">&quot;properties&quot;</span>: &#123;                                                                                                                                                                           |</span><br><span class="line">|            |     <span class="string">&quot;destroy_after_deletion&quot;</span>: <span class="literal">true</span>,                                                                                                                                                         |</span><br><span class="line">|            |     <span class="string">&quot;grace_period&quot;</span>: 60,                                                                                                                                                                     |</span><br><span class="line">|            |     <span class="string">&quot;reduce_desired_capacity&quot;</span>: <span class="literal">false</span>,                                                                                                                                                       |</span><br><span class="line">|            |     <span class="string">&quot;criteria&quot;</span>: <span class="string">&quot;OLDEST_FIRST&quot;</span>                                                                                                                                                              |</span><br><span class="line">|            |   &#125;                                                                                                                                                                                         |</span><br><span class="line">|            | &#125;                                                                                                                                                                                           |</span><br><span class="line">| <span class="built_in">type</span>       | senlin.policy.deletion-1.0                                                                                                                                                                  |</span><br><span class="line">| updated_at | None                                                                                                                                                                                        |</span><br><span class="line">| user_id    | c1bb613f1ece4654b488c65fc0f62df8                                                                                                                                                            |</span><br><span class="line">+------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br></pre></td></tr></table></figure>
<h5 id="查看Policies"><a href="#查看Policies" class="headerlink" title="查看Policies"></a>查看Policies</h5><p>查看Policy列表。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster policy list</span><br></pre></td></tr></table></figure>
<div class="figure " style="width:;"><a class="fancybox" href="images/policy-list.png" title="" data-caption="" data-fancybox="default"><img class="fig-img" src="images/policy-list.png" alt=""></a></div>

<h5 id="查看详细Policy"><a href="#查看详细Policy" class="headerlink" title="查看详细Policy"></a>查看详细Policy</h5><p>查看Policy的详细信息。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster policy show delete_policy</span><br></pre></td></tr></table></figure>

<h5 id="更新Policy"><a href="#更新Policy" class="headerlink" title="更新Policy"></a>更新Policy</h5><p>更改Policy的名称。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster policy update --name my_policy delete_policy</span><br></pre></td></tr></table></figure>

<h5 id="删除Policy"><a href="#删除Policy" class="headerlink" title="删除Policy"></a>删除Policy</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster policy delete delete_policy</span><br></pre></td></tr></table></figure>

<h4 id="Cluster-Policy-Binding"><a href="#Cluster-Policy-Binding" class="headerlink" title="Cluster-Policy Binding"></a>Cluster-Policy Binding</h4><p>可以同时将策略对象（Policy）附加到至少一个集群（Cluster）。集群在任何时候都可以连接多个策略对象。将策略对象附加到群集后，仍然可以启用或禁用它，或更新策略对象的某些属性。</p>
<h5 id="集群绑定策略"><a href="#集群绑定策略" class="headerlink" title="集群绑定策略"></a>集群绑定策略</h5><p>Senlin允许将策略对象附加到集群，并动态地将其与集群分离。将策略对象附加到集群时，可以自定义特定集群的策略属性。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster policy attach --policy delete_policy --enabled False my_cluster</span><br></pre></td></tr></table></figure>
<div class="alert info no-icon"><p><strong>--enabled</strong>：布尔值，指示绑定的策略是否要启用。</p>
</div>

<div class="alert warning no-icon"><p>请注意，在大多数情况下，Senlin不允许将多个相同类型的策略附加到同一群集。对于某些策略类型，此限制已放宽。例如，在使用有关扩展的策略时，实际上可以将多个策略实例附加到同一群集，每个实例都与特定场景有关。</p>
</div>

<h5 id="查看集群策略"><a href="#查看集群策略" class="headerlink" title="查看集群策略"></a>查看集群策略</h5><p>查看指定集群的策略列表。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster policy binding list my_cluster</span><br></pre></td></tr></table></figure>
<div class="figure " style="width:;"><a class="fancybox" href="images/policy-binding-list.png" title="" data-caption="" data-fancybox="default"><img class="fig-img" src="images/policy-binding-list.png" alt=""></a></div>

<h5 id="查看集群详细策略"><a href="#查看集群详细策略" class="headerlink" title="查看集群详细策略"></a>查看集群详细策略</h5><p>查看指定集群的指定策略的详细信息。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster policy binding show  --policy delete_policy my_cluster</span><br><span class="line"></span><br><span class="line">+--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Field        | Value                                                                                                                                                                                       |</span><br><span class="line">+--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| cluster_name | my_cluster                                                                                                                                                                                  |</span><br><span class="line">| data         | None                                                                                                                                                                                        |</span><br><span class="line">| <span class="built_in">id</span>           | fbeef144-dae1-48c1-a78a-1d839fbccff9                                                                                                                                                        |</span><br><span class="line">| is_enabled   | False                                                                                                                                                                                       |</span><br><span class="line">| location     | Munch(&#123;<span class="string">&#x27;project&#x27;</span>: Munch(&#123;<span class="string">&#x27;domain_id&#x27;</span>: None, <span class="string">&#x27;id&#x27;</span>: u<span class="string">&#x27;f52380b8eb5345f0a568a186a5a832a5&#x27;</span>, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;domain_name&#x27;</span>: <span class="string">&#x27;Default&#x27;</span>&#125;), <span class="string">&#x27;cloud&#x27;</span>: <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;region_name&#x27;</span>: <span class="string">&#x27;RegionOne&#x27;</span>, <span class="string">&#x27;zone&#x27;</span>: None&#125;) |</span><br><span class="line">| name         | None                                                                                                                                                                                        |</span><br><span class="line">| policy_id    | 53d08309-236e-4e49-87b1-a913077b6c79                                                                                                                                                        |</span><br><span class="line">| policy_name  | delete_policy                                                                                                                                                                               |</span><br><span class="line">| policy_type  | senlin.policy.deletion-1.0                                                                                                                                                                  |</span><br><span class="line">+--------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br></pre></td></tr></table></figure>

<h5 id="更新集群的策略"><a href="#更新集群的策略" class="headerlink" title="更新集群的策略"></a>更新集群的策略</h5><p>更新指定集群的策略信息。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster policy binding update \</span><br><span class="line">    --enabled True \</span><br><span class="line">    --policy my_delete my_cluster</span><br></pre></td></tr></table></figure>

<h5 id="集群解绑策略"><a href="#集群解绑策略" class="headerlink" title="集群解绑策略"></a>集群解绑策略</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster policy detach --policy my_delete mycluster</span><br></pre></td></tr></table></figure>

<h4 id="Receiver"><a href="#Receiver" class="headerlink" title="Receiver"></a>Receiver</h4><p>接收器（Receiver）用于使senlin-engine准备好对外部警报或事件做出反应，以便可以在集群上自动启动特定的操作。例如，当集群上的负载上升时，Receiver可以更改指定集群的大小。</p>
<h5 id="创建Receiver"><a href="#创建Receiver" class="headerlink" title="创建Receiver"></a>创建Receiver</h5><p>目前，Senlin支持两种接收器类型：<strong>webhook</strong>和<strong>message</strong>。前者，将生成一个永久的Webhook网址，供用户通过发送HTTP POST请求在给定集群上触发特定操作。对于后者，将创建Zaqar消息队列，以供用户发布消息，此类消息用于通知Senlin服务以针对特定集群启动操作。</p>
<h6 id="Webhook-Receiver"><a href="#Webhook-Receiver" class="headerlink" title="Webhook Receiver"></a>Webhook Receiver</h6><p>创建类型为Webhook的Receiver。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster receiver create --cluster my_cluster --action CLUSTER_SCALE_OUT --<span class="built_in">type</span> webhook webhook_receiver</span><br><span class="line"></span><br><span class="line">+------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Field      | Value                                                                                                                                                                                       |</span><br><span class="line">+------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| action     | CLUSTER_SCALE_OUT                                                                                                                                                                           |</span><br><span class="line">| actor      | &#123;                                                                                                                                                                                           |</span><br><span class="line">|            |   <span class="string">&quot;trust_id&quot;</span>: <span class="string">&quot;267bd0d37750422a92715b36257f1e85&quot;</span>                                                                                                                                            |</span><br><span class="line">|            | &#125;                                                                                                                                                                                           |</span><br><span class="line">| channel    | &#123;                                                                                                                                                                                           |</span><br><span class="line">|            |   <span class="string">&quot;alarm_url&quot;</span>: <span class="string">&quot;http://192.168.10.20:8778/v1/webhooks/e00915bc-51ca-4a88-ade1-491327fb604c/trigger?V=1&quot;</span>                                                                                     |</span><br><span class="line">|            | &#125;                                                                                                                                                                                           |</span><br><span class="line">| cluster_id | eb5843d4-18c7-465f-bf65-76693f617f51                                                                                                                                                        |</span><br><span class="line">| created_at | 2019-09-27T02:48:42Z                                                                                                                                                                        |</span><br><span class="line">| domain_id  | None                                                                                                                                                                                        |</span><br><span class="line">| <span class="built_in">id</span>         | e00915bc-51ca-4a88-ade1-491327fb604c                                                                                                                                                        |</span><br><span class="line">| location   | Munch(&#123;<span class="string">&#x27;project&#x27;</span>: Munch(&#123;<span class="string">&#x27;domain_id&#x27;</span>: None, <span class="string">&#x27;id&#x27;</span>: u<span class="string">&#x27;f52380b8eb5345f0a568a186a5a832a5&#x27;</span>, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;domain_name&#x27;</span>: <span class="string">&#x27;Default&#x27;</span>&#125;), <span class="string">&#x27;cloud&#x27;</span>: <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;region_name&#x27;</span>: <span class="string">&#x27;RegionOne&#x27;</span>, <span class="string">&#x27;zone&#x27;</span>: None&#125;) |</span><br><span class="line">| name       | webhook_receiver                                                                                                                                                                            |</span><br><span class="line">| params     | &#123;&#125;                                                                                                                                                                                          |</span><br><span class="line">| project_id | f52380b8eb5345f0a568a186a5a832a5                                                                                                                                                            |</span><br><span class="line">| <span class="built_in">type</span>       | webhook                                                                                                                                                                                     |</span><br><span class="line">| updated_at | None                                                                                                                                                                                        |</span><br><span class="line">| user_id    | c1bb613f1ece4654b488c65fc0f62df8                                                                                                                                                            |</span><br><span class="line">+------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br></pre></td></tr></table></figure>

<div class="alert info no-icon"><p>对于Webhook接收器，可以检查<strong>channel</strong>属性的<strong>alarm_url</strong>字段。可以使用此URL触发指定的操作。</p>
</div>

<p>以下命令通过将POST请求发送到alarm_url来触发Receiver。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST &lt;alarm_url&gt;</span><br></pre></td></tr></table></figure>

<h6 id="Message-Receiver"><a href="#Message-Receiver" class="headerlink" title="Message Receiver"></a>Message Receiver</h6><p>Message Receiver与Webhook Receiver的不同之处在于，它可以在不同的集群上触发不同的操作。因此，在创建Message Receiver时，可以省略选项<strong>--cluster</strong>和选项<strong>--action</strong>。Senlin将检查传入的消息是否包含此类属性。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster receiver create --<span class="built_in">type</span> message message-receiver</span><br></pre></td></tr></table></figure>
<p>创建消息接收器后，可以将以下格式的消息发送到命名的Zaqar队列，触发Receiver。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;messages&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;ttl&quot;</span><span class="punctuation">:</span> <span class="number">300</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;body&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;cluster&quot;</span><span class="punctuation">:</span> <span class="string">&quot;my-cluster&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;action&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CLUSTER_SCALE_IN&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;params&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;count&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="Action"><a href="#Action" class="headerlink" title="Action"></a>Action</h4><p>Action是可以在集群或节点上执行的操作。每个Action在创建后都由工作线程异步执行。除某些对象检索或对象列表API外，大多数Senlin API在senlin-engine内异步执行。</p>
<p>不同类型的对象支持不同的动作集。例如，集群（Cluster）支持以下操作：</p>
<ul>
<li>CREATE: creates a cluster;</li>
<li>DELETE: deletes a cluster;</li>
<li>UPDATE: update the properties and/or the profile used by a cluster;</li>
<li>ADD_NODES: add existing nodes to a cluster;</li>
<li>DEL_NODES: remove nodes from a cluster;</li>
<li>ATTACH_POLICY: attach the specified policy to a cluster;</li>
<li>DETACH_POLICY: detach the specified policy from a cluster;</li>
<li>UPDATE_POLICY: update the specified policy on a cluster;</li>
<li>SCALE_IN: shrink the size of a cluster;</li>
<li>SCALE_OUT: inflate the size of a cluster;</li>
<li>RESIZE: resize a cluster;</li>
<li>CHECK: check a cluster;</li>
<li>RECOVER: recover a cluster;</li>
<li>REPLACE_NODES: replace the nodes in cluster with specified nodes;</li>
<li>OPERATION: perform an operation on the specified cluster;</li>
</ul>
<p>节点（Node）支持以下操作：</p>
<ul>
<li>CREATE: creates a node;</li>
<li>DELETE: deletes a node;</li>
<li>UPDATE: updates the properties and/or the profile used by a node;</li>
<li>CHECK: check a node;</li>
<li>RECOVER: recover a node;</li>
<li>OPERATION: perform an operation on the specified node;</li>
</ul>
<h5 id="查看Actions"><a href="#查看Actions" class="headerlink" title="查看Actions"></a>查看Actions</h5><p>查看Action列表。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster action list </span><br></pre></td></tr></table></figure>
<div class="figure " style="width:;"><a class="fancybox" href="images/action-list.png" title="" data-caption="" data-fancybox="default"><img class="fig-img" src="images/action-list.png" alt=""></a></div>

<h5 id="查看详细Action"><a href="#查看详细Action" class="headerlink" title="查看详细Action"></a>查看详细Action</h5><p>查看Action的详细信息。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster action show c3bee157</span><br><span class="line"></span><br><span class="line">+---------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Field         | Value                                                                                                                                                                                       |</span><br><span class="line">+---------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| action        | CLUSTER_CREATE                                                                                                                                                                              |</span><br><span class="line">| cause         | RPC Request                                                                                                                                                                                 |</span><br><span class="line">| created_at    | 2019-09-25T09:20:40Z                                                                                                                                                                        |</span><br><span class="line">| depended_by   |                                                                                                                                                                                             |</span><br><span class="line">| depends_on    |                                                                                                                                                                                             |</span><br><span class="line">| domain_id     | None                                                                                                                                                                                        |</span><br><span class="line">| end_at        | 1569403240.87                                                                                                                                                                               |</span><br><span class="line">| <span class="built_in">id</span>            | c3bee157-00fd-4330-a049-3a3feb0cd593                                                                                                                                                        |</span><br><span class="line">| inputs        | &#123;&#125;                                                                                                                                                                                          |</span><br><span class="line">| interval      | -1                                                                                                                                                                                          |</span><br><span class="line">| location      | Munch(&#123;<span class="string">&#x27;project&#x27;</span>: Munch(&#123;<span class="string">&#x27;domain_id&#x27;</span>: None, <span class="string">&#x27;id&#x27;</span>: u<span class="string">&#x27;f52380b8eb5345f0a568a186a5a832a5&#x27;</span>, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;domain_name&#x27;</span>: <span class="string">&#x27;Default&#x27;</span>&#125;), <span class="string">&#x27;cloud&#x27;</span>: <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;region_name&#x27;</span>: <span class="string">&#x27;RegionOne&#x27;</span>, <span class="string">&#x27;zone&#x27;</span>: None&#125;) |</span><br><span class="line">| name          | cluster_create_eb5843d4                                                                                                                                                                     |</span><br><span class="line">| outputs       | &#123;&#125;                                                                                                                                                                                          |</span><br><span class="line">| owner_id      | None                                                                                                                                                                                        |</span><br><span class="line">| project_id    | f52380b8eb5345f0a568a186a5a832a5                                                                                                                                                            |</span><br><span class="line">| start_at      | 1569403240.47                                                                                                                                                                               |</span><br><span class="line">| status        | SUCCEEDED                                                                                                                                                                                   |</span><br><span class="line">| status_reason | Action completed successfully.                                                                                                                                                              |</span><br><span class="line">| target_id     | eb5843d4-18c7-465f-bf65-76693f617f51                                                                                                                                                        |</span><br><span class="line">| <span class="built_in">timeout</span>       | 3600                                                                                                                                                                                        |</span><br><span class="line">| updated_at    | None                                                                                                                                                                                        |</span><br><span class="line">| user_id       | c1bb613f1ece4654b488c65fc0f62df8                                                                                                                                                            |</span><br><span class="line">+---------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="Event"><a href="#Event" class="headerlink" title="Event"></a>Event</h4><p>事件（Event）是senlin-engine执行期间生成的记录。senlin-engine服务在执行某些操作或检查策略时会生成事件记录。</p>
<p>事件（Event）具有级别属性，可以将其解释为事件的严重性级别值：</p>
<ul>
<li>10: interpreted as DEBUG level. Events at this level can be ignored safely by users. For developers they may provide some useful information for debugging the code.</li>
<li>20: interpreted as INFO level. Events at this level are mostly about notifying that some operations have been successfully performed.</li>
<li>30: interpreted as WARNING level. Events at this level are used to signal some unhealthy status or anomalies detected by the engine. These events should be monitored and checked when operating a cluster.</li>
<li>40: interpreted as ERROR level. Events at this level signifies some failures in engine operations. These event should be monitored and checked when operating a cluster. Usually some user intervention is expected to recover a cluster from this status.</li>
<li>50: interpreted as CRITICAL level. Events at this level are about serious problems encountered by the engine. The engine service may have run into some bugs. User intervention is required to do a recovery.</li>
</ul>
<h5 id="Event-Dispatcher-Configuration"><a href="#Event-Dispatcher-Configuration" class="headerlink" title="Event Dispatcher Configuration"></a>Event Dispatcher Configuration</h5><p>Senlin提供了用于事件调度的开放式体系结构。内置调度程序中的两个是数据库和消息。</p>
<ol>
<li><p>数据库调度程序将事件转储到数据库表中，并且默认情况下启用。</p>
</li>
<li><p>消息调度程序将事件对象转换为版本化的事件通知，并发布在全局消息队列中。默认情况下，禁用此调度程序。要启用它，可以将以下行添加到senlin.conf文件的[DEFAULT]部分，然后重新启动senlin-engine：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[default]</span><br><span class="line">event_dispatchers = message</span><br></pre></td></tr></table></figure>
<p>根据部署设置，使用消息分发程序时，还必须将以下行添加到senlin.conf文件中。这些行将消息传递设置为oslo.messaging软件包使用的默认驱动程序：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[oslo_messaging_notifications]</span><br><span class="line">driver = messaging</span><br></pre></td></tr></table></figure>
<p>使用此配置，数据库分发程序将被禁用，这意味着您只能通过消息队列访问事件。</p>
</li>
<li><p>event_dispatchers字段为MultiString时，如果需要，可以同时启用数据库分发程序和消息分发程序：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[default]</span><br><span class="line">event_dispatchers = database</span><br><span class="line">event_dispatchers = message</span><br><span class="line"></span><br><span class="line">[oslo_messaging_notifications]</span><br><span class="line">driver = messaging</span><br></pre></td></tr></table></figure>

</li>
</ol>
<div class="alert warning no-icon"><p>请注意，默认情况下，与TTL（生存时间）值不相关的未处理事件通知将保留在消息总线上，在启用消息分派器之前，请确保Senlin事件通知将被某些服务订阅并处理。</p>
</div>

<p>By default, we use the senlin exchange which type is TOPIC to route the notifications to queues with different routing_key. The queues name could be versioned_notifications.debug, versioned_notifications.info, versioned_notifications.warn and versioned_notifications.error that depends on the log level you are using in senlin.conf. The corresponding routing_key are the same as the queues’ name.</p>
<p>There are two options to consume the notifications:</p>
<ul>
<li>Consume the notifications from the default queues directlly.</li>
<li>Declare your own queues, then bind them to senlin exchange with corresponding routing_key to customize the flow.</li>
</ul>
<h5 id="查看Events"><a href="#查看Events" class="headerlink" title="查看Events"></a>查看Events</h5><p>查看Event列表。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster event list</span><br></pre></td></tr></table></figure>
<div class="figure " style="width:;"><a class="fancybox" href="images/event-list.png" title="" data-caption="" data-fancybox="default"><img class="fig-img" src="images/event-list.png" alt=""></a></div>

<h5 id="查看详细Event"><a href="#查看详细Event" class="headerlink" title="查看详细Event"></a>查看详细Event</h5><p>查看Event的详细信息。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">openstack cluster event show 932d0009                                                                </span><br><span class="line"></span><br><span class="line">+---------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Field         | Value                                                                                                                                                                                       |</span><br><span class="line">+---------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| action        | CLUSTER_CREATE                                                                                                                                                                              |</span><br><span class="line">| cluster_id    | eb5843d4-18c7-465f-bf65-76693f617f51                                                                                                                                                        |</span><br><span class="line">| generated_at  | 2019-09-25T09:20:40+00:00                                                                                                                                                                   |</span><br><span class="line">| <span class="built_in">id</span>            | 932d0009-286f-40e1-81e0-3b44a41657da                                                                                                                                                        |</span><br><span class="line">| level         | INFO                                                                                                                                                                                        |</span><br><span class="line">| location      | Munch(&#123;<span class="string">&#x27;project&#x27;</span>: Munch(&#123;<span class="string">&#x27;domain_id&#x27;</span>: None, <span class="string">&#x27;id&#x27;</span>: u<span class="string">&#x27;f52380b8eb5345f0a568a186a5a832a5&#x27;</span>, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;domain_name&#x27;</span>: <span class="string">&#x27;Default&#x27;</span>&#125;), <span class="string">&#x27;cloud&#x27;</span>: <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;region_name&#x27;</span>: <span class="string">&#x27;RegionOne&#x27;</span>, <span class="string">&#x27;zone&#x27;</span>: None&#125;) |</span><br><span class="line">| name          | None                                                                                                                                                                                        |</span><br><span class="line">| obj_id        | eb5843d4-18c7-465f-bf65-76693f617f51                                                                                                                                                        |</span><br><span class="line">| obj_name      | my_cluster                                                                                                                                                                                  |</span><br><span class="line">| obj_type      | CLUSTER                                                                                                                                                                                     |</span><br><span class="line">| project_id    | f52380b8eb5345f0a568a186a5a832a5                                                                                                                                                            |</span><br><span class="line">| status        | start                                                                                                                                                                                       |</span><br><span class="line">| status_reason | c3bee157                                                                                                                                                                                    |</span><br><span class="line">| user_id       | c1bb613f1ece4654b488c65fc0f62df8                                                                                                                                                            |</span><br><span class="line">+---------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br></pre></td></tr></table></figure>
            


        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">TAGGED IN</span><br/>
                
    <a class="tag tag--primary tag--small t-none-link" href="/tags/OpenStack/" rel="tag">OpenStack</a> <a class="tag tag--primary tag--small t-none-link" href="/tags/Senlin/" rel="tag">Senlin</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2019/09/27/OpenStack-Senlin%E8%87%AA%E5%8A%A8%E4%BC%B8%E7%BC%A9/"
                    data-tooltip="OpenStack Senlin自动伸缩"
                    aria-label="PREVIOUS: OpenStack Senlin自动伸缩"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2019/09/19/Neutron-OpenvSwitch-GRE-VxLAN%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C/"
                    data-tooltip="Neutron OpenvSwitch + GRE/VxLAN虚拟网络"
                    aria-label="NEXT: Neutron OpenvSwitch + GRE/VxLAN虚拟网络"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="http://service.weibo.com/share/share.php?&amp;title=https://wangkuntian.github.io/2019/09/25/OpenStack-Senlin%E9%9B%86%E7%BE%A4%E5%8D%B3%E6%9C%8D%E5%8A%A1/"
                    title="Share on Weibo"
                    aria-label="Share on Weibo"
                >
                    <i class="fab fa-weibo" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="http://connect.qq.com/widget/shareqq/index.html?url=https://wangkuntian.github.io/2019/09/25/OpenStack-Senlin%E9%9B%86%E7%BE%A4%E5%8D%B3%E6%9C%8D%E5%8A%A1/&amp;title=OpenStack Senlin集群即服务"
                    title="Share on QQ"
                    aria-label="Share on QQ"
                >
                    <i class="fab fa-qq" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://wangkuntian.github.io/2019/09/25/OpenStack-Senlin%E9%9B%86%E7%BE%A4%E5%8D%B3%E6%9C%8D%E5%8A%A1/"
                    title="Share on Qzone"
                    aria-label="Share on Qzone"
                >
                    <i class="fa fa-star" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#table-of-contents" aria-label="目录">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
        
    </div>
</article>

<div class="main-content-wrap">
    
        
            <script src="//cdn.jsdelivr.net/npm/@waline/client"></script>
阅读量：<span id="2019/09/25/OpenStack-Senlin集群即服务/" class="waline-visitor-count"></span>
<div id="vcomments"></div>
<script>
    new Waline({
        el: "#vcomments",
        serverURL: "https://blog-api-nu-nine.vercel.app/",
        lang: "zh-cn",
        visitor: true,
        emoji: [
            "https://cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/bilibili",
            "https://cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/qq",
        ],
        placeholder: "ヾﾉ≧∀≦)o来啊，快活啊!",
        dark: "auto",
        meta: ["nick", "mail", "link"],
        requiredMeta: [],
        wordLimit: "200",
        pageSize: "10",
        highlight: "hanabi",
        copyright: true,
        avatar: "wavatar",
    });
</script>
  
        
    
</div>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2024 Wang kuntian. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2019/09/27/OpenStack-Senlin%E8%87%AA%E5%8A%A8%E4%BC%B8%E7%BC%A9/"
                    data-tooltip="OpenStack Senlin自动伸缩"
                    aria-label="PREVIOUS: OpenStack Senlin自动伸缩"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2019/09/19/Neutron-OpenvSwitch-GRE-VxLAN%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C/"
                    data-tooltip="Neutron OpenvSwitch + GRE/VxLAN虚拟网络"
                    aria-label="NEXT: Neutron OpenvSwitch + GRE/VxLAN虚拟网络"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="http://service.weibo.com/share/share.php?&amp;title=https://wangkuntian.github.io/2019/09/25/OpenStack-Senlin%E9%9B%86%E7%BE%A4%E5%8D%B3%E6%9C%8D%E5%8A%A1/"
                    title="Share on Weibo"
                    aria-label="Share on Weibo"
                >
                    <i class="fab fa-weibo" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="http://connect.qq.com/widget/shareqq/index.html?url=https://wangkuntian.github.io/2019/09/25/OpenStack-Senlin%E9%9B%86%E7%BE%A4%E5%8D%B3%E6%9C%8D%E5%8A%A1/&amp;title=OpenStack Senlin集群即服务"
                    title="Share on QQ"
                    aria-label="Share on QQ"
                >
                    <i class="fab fa-qq" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://wangkuntian.github.io/2019/09/25/OpenStack-Senlin%E9%9B%86%E7%BE%A4%E5%8D%B3%E6%9C%8D%E5%8A%A1/"
                    title="Share on Qzone"
                    aria-label="Share on Qzone"
                >
                    <i class="fa fa-star" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#table-of-contents" aria-label="目录">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="4">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="http://service.weibo.com/share/share.php?&amp;title=https://wangkuntian.github.io/2019/09/25/OpenStack-Senlin%E9%9B%86%E7%BE%A4%E5%8D%B3%E6%9C%8D%E5%8A%A1/"
                        aria-label="Share on Weibo"
                    >
                        <i class="fab fa-weibo" aria-hidden="true"></i><span>Share on Weibo</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="http://connect.qq.com/widget/shareqq/index.html?url=https://wangkuntian.github.io/2019/09/25/OpenStack-Senlin%E9%9B%86%E7%BE%A4%E5%8D%B3%E6%9C%8D%E5%8A%A1/&amp;title=OpenStack Senlin集群即服务"
                        aria-label="Share on QQ"
                    >
                        <i class="fab fa-qq" aria-hidden="true"></i><span>Share on QQ</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://wangkuntian.github.io/2019/09/25/OpenStack-Senlin%E9%9B%86%E7%BE%A4%E5%8D%B3%E6%9C%8D%E5%8A%A1/"
                        aria-label="Share on Qzone"
                    >
                        <i class="fa fa-star" aria-hidden="true"></i><span>Share on Qzone</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/faker.jpg" alt="Author&#39;s picture"/>
        
            <h4 id="about-card-name">Wang kuntian</h4>
        
            <div id="about-card-bio"><p>Hi</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>Software Engineer</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br/>
                Beijing
            </div>
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover-v1.2.0.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/script-ndtc2tx33sr3grlppafri7aw03fwgxbruphsl7cntcdkym8tusuknerf6c0g.min.js"></script>

<!--SCRIPTS END-->


    




    <script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"display":{"superSample":2.5,"width":180,"height":400,"position":"right","hOffset":0,"vOffset":40},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.2},"dialog":{"enable":true,"hitokoto":false},"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2dw/assets/hibiki.model.json"},"log":false});</script></body>
</html>
